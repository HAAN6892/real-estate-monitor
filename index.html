<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ  ë¶€ë™ì‚° ëŒ€ì‹œë³´ë“œ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#06060b;--surface:#0d0d14;--surface2:#13131e;--surface3:#1a1a28;
  --border:#232336;--border-hover:#3a3a55;--text:#eeeef5;--text-dim:#7a7a95;--text-mid:#a0a0b8;
  --accent:#7c6af6;--accent2:#9d8df7;
  --green:#34d399;--green-dim:rgba(52,211,153,0.12);
  --red:#f87171;--red-dim:rgba(248,113,113,0.12);
  --yellow:#fbbf24;--yellow-dim:rgba(251,191,36,0.12);
  --blue:#60a5fa;--blue-dim:rgba(96,165,250,0.12);
  --mono:'JetBrains Mono',monospace;
  --mode-accent:#2563eb;--mode-accent-light:#eff6ff;--mode-bg:#f0f4ff;--mode-border:#dbe4f0;--mode-header-stripe:#2563eb;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden}
html{overflow-x:hidden}
.main{max-width:1100px;margin:0 auto;padding:20px 16px}
.top-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px;padding-bottom:16px;border-bottom:2px solid var(--mode-header-stripe)}
.top-bar-left{display:flex;align-items:center;gap:12px}
.logo{font-size:20px;font-weight:900;letter-spacing:-0.5px}
.logo-sub{font-size:11px;color:var(--text-dim)}
.top-bar-right{display:flex;align-items:center;gap:8px}
.settings-btn{background:var(--surface2);border:1px solid var(--border);color:var(--text-mid);padding:8px 16px;border-radius:8px;font-size:13px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all 0.2s;display:flex;align-items:center;gap:6px}
.settings-btn:hover{border-color:var(--accent);color:var(--text)}
.mode-toggle{display:flex;background:var(--surface2);border:1px solid var(--border);border-radius:8px;overflow:hidden}
.mode-btn{background:none;border:none;color:var(--text-dim);padding:8px 16px;font-size:13px;font-weight:600;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all 0.2s;display:flex;align-items:center;gap:5px;white-space:nowrap}
.mode-btn:hover{color:var(--text-mid)}
.mode-btn.active{background:var(--mode-accent);color:#fff;box-shadow:0 0 12px rgba(37,99,235,0.3)}
.settings-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:100;backdrop-filter:blur(4px)}
.settings-overlay.open{display:flex;justify-content:flex-end}
.settings-panel{background:var(--surface);width:340px;max-width:90vw;height:100vh;overflow-y:auto;padding:24px 20px;border-left:1px solid var(--border);animation:slideIn 0.25s ease}
@keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}
.settings-close{background:none;border:none;color:var(--text-mid);font-size:20px;cursor:pointer;float:right;padding:4px 8px}
.settings-close:hover{color:var(--text)}
.settings-title{font-size:18px;font-weight:700;margin-bottom:20px}
.section-label{font-size:10px;font-weight:700;color:var(--text-dim);letter-spacing:1.5px;text-transform:uppercase;margin:20px 0 10px;padding-bottom:6px;border-bottom:1px solid var(--border)}
.field{margin-bottom:14px}
.field label{display:block;font-size:12px;color:var(--text-mid);margin-bottom:4px;font-weight:500}
.field-row{display:flex;align-items:center;gap:8px}
.field input[type="range"]{flex:1;-webkit-appearance:none;height:4px;background:var(--border);border-radius:2px;outline:none}
.field input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:var(--accent);cursor:pointer;box-shadow:0 0 8px rgba(124,106,246,0.4)}
.field-value{font-family:var(--mono);font-size:14px;font-weight:600;width:72px;text-align:right;color:var(--text);background:var(--surface2);border:1px solid var(--border);border-radius:5px;padding:4px 8px;outline:none;-moz-appearance:textfield}
.field-value::-webkit-outer-spin-button,.field-value::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
.field-value:focus{border-color:var(--accent);background:var(--surface3)}
.field-unit{font-size:11px;color:var(--text-dim)}
.field select{width:100%;background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:6px;font-size:13px;font-family:'Noto Sans KR',sans-serif;cursor:pointer;outline:none}
.field-hint{font-size:10px;color:var(--text-dim);font-weight:400}
.policy-ref{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 12px;margin-bottom:10px;font-size:11px}
.policy-ref-title{font-weight:600;font-size:10px;color:var(--text-mid);margin-bottom:5px;letter-spacing:0.5px}
.policy-ref-row{display:flex;align-items:center;gap:6px;color:var(--text-dim);padding:1px 0}
.ref-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.buy-only{display:block}.rent-only{display:none}
body.mode-rent .buy-only{display:none}body.mode-rent .rent-only{display:block}
.marriage-status-bar{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:10px 16px;margin-bottom:16px;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.marriage-toggle{display:flex;background:var(--surface2);border:1px solid var(--border);border-radius:6px;overflow:hidden}
.marriage-btn{background:none;border:none;color:var(--text-dim);padding:6px 14px;font-size:12px;font-weight:600;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all 0.2s;white-space:nowrap}
.marriage-btn:hover{color:var(--text-mid)}
.marriage-btn.active{background:var(--mode-accent);color:#fff}
.marriage-info{font-size:11px;color:var(--text-dim);flex:1}
.marriage-info strong{color:var(--yellow)}
.marriage-income-badge{font-family:var(--mono);font-size:11px;padding:3px 10px;border-radius:4px;font-weight:600}
.marriage-income-badge.married{background:var(--yellow-dim);color:var(--yellow)}
.marriage-income-badge.single{background:var(--green-dim);color:var(--green)}
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:24px}
.stat-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px;transition:border-color 0.2s}
.stat-card:hover{border-color:var(--border-hover)}
.stat-label{font-size:10px;color:var(--text-dim);font-weight:500;letter-spacing:0.5px;margin-bottom:4px}
.stat-value{font-family:var(--mono);font-size:22px;font-weight:700;letter-spacing:-1px}
.stat-sub{font-size:10px;color:var(--text-dim);margin-top:3px}
.stat-bar{height:3px;border-radius:2px;margin-top:8px;background:var(--border);overflow:hidden}
.stat-bar-fill{height:100%;border-radius:2px;transition:width 0.4s ease}
.section{margin-bottom:28px}
.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:8px}
.section-title{font-size:15px;font-weight:700;display:flex;align-items:center;gap:8px}
.section-badge{font-size:11px;background:var(--surface3);color:var(--text-dim);padding:2px 10px;border-radius:10px}
.loan-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.loan-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:16px;position:relative;overflow:hidden}
.loan-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.loan-card.ok::before{background:var(--green)}.loan-card.warn::before{background:var(--yellow)}.loan-card.danger::before{background:var(--red)}
.loan-label{font-size:11px;color:var(--text-dim);margin-bottom:2px}
.loan-big{font-family:var(--mono);font-size:24px;font-weight:700;margin-bottom:2px}
.loan-detail{font-size:11px;color:var(--text-dim);line-height:1.6}.loan-detail span{color:var(--text-mid)}
.rent-loan-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
.table-controls{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap;align-items:center}
.filter-chip-group{display:flex;gap:4px;flex-wrap:wrap}
.filter-chip{background:var(--surface2);border:1px solid var(--border);color:var(--text-dim);padding:6px 12px;border-radius:20px;font-size:12px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all 0.15s;white-space:nowrap;user-select:none}
.filter-chip:hover{border-color:var(--mode-accent);color:var(--text-mid)}
.filter-chip.active{background:var(--mode-accent);color:#fff;border-color:var(--mode-accent)}
.filter-row{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap;align-items:center}
.filter-label{font-size:11px;color:var(--text-dim);min-width:40px;font-weight:500}
.search-input{flex:1;min-width:180px;background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:8px 12px;border-radius:8px;font-size:13px;font-family:'Noto Sans KR',sans-serif;outline:none}
.search-input::placeholder{color:var(--text-dim)}.search-input:focus{border-color:var(--mode-accent)}
.sort-btn{background:var(--surface2);border:1px solid var(--border);color:var(--text-mid);padding:7px 12px;border-radius:8px;font-size:12px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;white-space:nowrap;transition:all 0.15s}
.sort-btn:hover,.sort-btn.active{border-color:var(--mode-accent);color:var(--mode-accent)}
.filter-select{background:var(--surface2);border:1px solid var(--border);color:var(--text-mid);padding:7px 10px;border-radius:8px;font-size:12px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;outline:none}
.table-wrap{background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow-x:auto}
.pagination-bar{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-top:1px solid var(--border);background:var(--surface);font-size:12px;color:var(--text-dim)}
.page-size-select{background:var(--surface2);border:1px solid var(--border);color:var(--text-mid);padding:5px 8px;border-radius:6px;font-size:12px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;outline:none}
.page-btns{display:flex;gap:4px;align-items:center}
.page-btn{background:var(--surface2);border:1px solid var(--border);color:var(--text-mid);padding:5px 10px;border-radius:6px;font-size:12px;cursor:pointer;font-family:'Noto Sans KR',sans-serif;transition:all 0.15s}
.page-btn:hover{border-color:var(--mode-accent);color:var(--mode-accent)}
.page-btn.active{background:var(--mode-accent);color:#fff;border-color:var(--mode-accent)}
.page-btn:disabled{opacity:0.3;cursor:default}
.page-info{font-size:11px;color:var(--text-dim)}
.tab-nav{display:flex;gap:4px;margin-bottom:16px;border-bottom:2px solid var(--mode-border);padding-bottom:0}
.tab-btn{background:none;border:none;color:var(--text-dim);padding:10px 18px;font-size:13px;font-weight:600;cursor:pointer;font-family:'Noto Sans KR',sans-serif;border-bottom:2px solid transparent;margin-bottom:-2px;transition:all 0.2s;white-space:nowrap}
.tab-btn:hover{color:var(--text-mid)}.tab-btn.active{color:var(--mode-accent);border-bottom-color:var(--mode-accent)}
.tab-content{display:none}.tab-content.active{display:block}
table{width:100%;border-collapse:collapse;font-size:13px}thead{background:var(--surface2)}
th{padding:9px 10px;text-align:left;font-weight:500;color:var(--text-dim);font-size:11px;letter-spacing:0.5px;cursor:pointer;white-space:nowrap}th:hover{color:var(--text-mid)}
td{padding:10px;border-top:1px solid var(--border);vertical-align:top}tr:hover td{background:rgba(37,99,235,0.04)}
.col-name{min-width:250px}.col-region{min-width:80px}.col-area{min-width:60px}.col-price{min-width:100px}.col-equity{min-width:100px}.col-loan{min-width:100px}.col-monthly{min-width:70px}.col-verdict{min-width:70px}.col-link{min-width:50px}
.mono{font-family:var(--mono);font-weight:600}
.tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:500}
.tag-ok{background:var(--green-dim);color:var(--green)}.tag-warn{background:var(--yellow-dim);color:var(--yellow)}.tag-danger{background:var(--red-dim);color:var(--red)}.tag-region{background:var(--blue-dim);color:var(--blue);font-size:10px}
.link-icons{display:flex;gap:4px}
.link-icon{display:inline-flex;align-items:center;justify-content:center;width:26px;height:26px;border-radius:6px;font-size:12px;text-decoration:none;transition:all 0.15s;background:var(--surface3);color:var(--text-mid);border:1px solid var(--border)}
.link-icon:hover{border-color:var(--mode-accent);color:var(--mode-accent);transform:scale(1.1)}
.condition-row{display:flex;flex-wrap:wrap;gap:6px}
.cond-chip{background:var(--surface2);border:1px solid var(--border);padding:5px 12px;border-radius:20px;font-size:11px;color:var(--text-mid);white-space:nowrap}
.quick-links{display:flex;flex-wrap:wrap;gap:8px}
.area-toggle{cursor:pointer;user-select:none}.area-toggle:hover{color:var(--accent2)}
#areaUnitLabel{font-size:10px;padding:1px 5px;background:var(--mode-accent);color:#fff;border-radius:3px}
.quick-link{display:flex;align-items:center;gap:8px;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:10px 14px;text-decoration:none;color:var(--text);transition:all 0.2s;flex:1;min-width:140px}
.quick-link:hover{border-color:var(--mode-accent);transform:translateY(-1px)}
.ql-icon{font-size:18px}.ql-name{font-size:13px;font-weight:600}.ql-desc{font-size:10px;color:var(--text-dim)}
.timeline{display:flex;flex-direction:column;gap:8px}
.tl-item{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:12px 14px;display:flex;gap:12px;align-items:flex-start;transition:border-color 0.2s}
.tl-item:hover{border-color:var(--border-hover)}
.tl-dot{width:8px;height:8px;border-radius:50%;margin-top:6px;flex-shrink:0}
.tl-dot.high{background:var(--red);box-shadow:0 0 6px rgba(248,113,113,0.5)}.tl-dot.mid{background:var(--yellow)}.tl-dot.low{background:var(--green)}
.tl-date{font-family:var(--mono);font-size:11px;color:var(--text-dim);min-width:72px;padding-top:1px}
.tl-body{flex:1}.tl-title{font-size:13px;font-weight:600;margin-bottom:2px}
.tl-impact{font-size:11px;color:var(--text-dim);line-height:1.5}.tl-impact em{color:var(--yellow);font-style:normal}
.tl-my-impact{font-size:10px;margin-top:6px;padding:5px 10px;border-radius:6px;border:1px solid var(--border);background:var(--surface2)}
.tl-my-impact .impact-label{font-weight:600;margin-bottom:2px}
.tl-my-impact.positive{border-color:rgba(52,211,153,0.3);background:rgba(52,211,153,0.05)}
.tl-my-impact.positive .impact-label{color:var(--green)}
.tl-my-impact.negative{border-color:rgba(248,113,113,0.3);background:rgba(248,113,113,0.05)}
.tl-my-impact.negative .impact-label{color:var(--red)}
.tl-my-impact.neutral{border-color:rgba(251,191,36,0.3);background:rgba(251,191,36,0.05)}
.tl-my-impact.neutral .impact-label{color:var(--yellow)}
.policy-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.policy-card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px;position:relative;overflow:hidden}
.policy-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
.policy-card.eligible::before{background:var(--green)}.policy-card.ineligible::before{background:var(--red)}.policy-card.conditional::before{background:var(--yellow)}.policy-card.checking::before{background:var(--blue)}
.policy-name{font-size:13px;font-weight:700;margin-bottom:2px;display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.policy-status{font-size:11px;font-weight:600}
.policy-status.yes{color:var(--green)}.policy-status.no{color:var(--red)}.policy-status.maybe{color:var(--yellow)}.policy-status.check{color:var(--blue)}
.policy-detail{font-size:11px;color:var(--text-dim);margin-top:4px;line-height:1.5}
.policy-gap{font-family:var(--mono);font-size:10px;margin-top:5px;padding:3px 8px;border-radius:4px;display:inline-block}
.policy-gap.over{background:var(--red-dim);color:var(--red)}.policy-gap.close{background:var(--yellow-dim);color:var(--yellow)}.policy-gap.under{background:var(--green-dim);color:var(--green)}
.policy-what-if{font-size:10px;color:var(--accent2);margin-top:5px;padding:4px 8px;background:rgba(124,106,246,0.08);border-radius:4px;border:1px solid rgba(124,106,246,0.15)}
.footer{text-align:center;padding:16px;font-size:11px;color:var(--text-dim);border-top:1px solid var(--border);margin-top:20px}
.rent-placeholder{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:40px 20px;text-align:center}
.rent-placeholder-icon{font-size:36px;margin-bottom:12px}.rent-placeholder-title{font-size:15px;font-weight:700;margin-bottom:6px}
.rent-placeholder-desc{font-size:12px;color:var(--text-dim);line-height:1.6;margin-bottom:16px}
.rent-placeholder-links{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.trade-history{grid-column:1/-1;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 12px;margin-top:4px;display:none;min-width:280px}
.trade-history.open{display:block}
.trade-history-title{font-size:11px;font-weight:600;color:var(--mode-accent);margin-bottom:6px;display:flex;justify-content:space-between;align-items:center}
.trade-row{display:flex;gap:12px;padding:4px 0;font-size:11px;border-bottom:1px solid var(--border);align-items:center;white-space:nowrap}
.trade-row:last-child{border-bottom:none}
.trade-date{color:var(--text-dim);min-width:75px}.trade-price{font-family:var(--mono);font-weight:600;min-width:85px}.trade-floor{color:var(--text-mid);min-width:30px}
.trade-delta{font-family:var(--mono);font-size:10px;min-width:60px}.trade-delta.up{color:var(--red)}.trade-delta.down{color:var(--green)}.trade-delta.same{color:var(--text-dim)}
.expand-btn{cursor:pointer;color:var(--mode-accent);font-size:10px;background:none;border:none;padding:0;font-family:'Noto Sans KR',sans-serif}.expand-btn:hover{opacity:0.8}
@media(max-width:768px){
  #mapContainer{height:400px!important}
  .main{padding:12px 10px}.stats-row{grid-template-columns:repeat(2,1fr);gap:8px}.stat-value{font-size:18px}
  .loan-grid,.rent-loan-grid{grid-template-columns:1fr}.loan-big{font-size:20px}.policy-grid{grid-template-columns:1fr}
  .tl-item{flex-direction:column;gap:4px}.tl-date{min-width:auto}
  .quick-links{gap:6px}.quick-link{min-width:calc(50% - 6px);flex:none;padding:8px 10px}.ql-desc{display:none}
  .tab-btn{padding:8px 14px;font-size:12px}.mode-btn{padding:6px 12px;font-size:12px}
  .table-wrap{background:none;border:none;border-radius:0}
  table,thead,tbody,th,td,tr{display:block}thead{display:none}
  tr{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:10px;display:grid;grid-template-columns:1fr 1fr;gap:6px 12px}
  tr:hover td{background:transparent}td{padding:2px 0;border:none}
  td:nth-child(1){grid-column:1/-1;font-size:14px;margin-bottom:4px}td:nth-child(9){grid-column:1/-1}
  td::before{content:attr(data-label);display:block;font-size:10px;color:var(--text-dim);margin-bottom:1px}
  .marriage-status-bar{flex-direction:column;align-items:flex-start;gap:8px}
}
</style>
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=12e8b95a1df898f6b847892500770551&autoload=false&libraries=services"></script>
</head>
<body>
<div class="main" id="main">
  <div class="top-bar">
    <div class="top-bar-left"><div><div class="logo" id="logoText">ğŸ  ìš°ë¦¬ ì§‘ ì‚¬ê¸°</div><div class="logo-sub" id="dataStatus">ë°ì´í„° ë¡œë”© ì¤‘...</div></div></div>
    <div class="top-bar-right">
      <div class="mode-toggle">
        <button class="mode-btn active" data-mode="buy" onclick="switchMode('buy')">ğŸ  ë§¤ìˆ˜</button>
        <button class="mode-btn" data-mode="rent" onclick="switchMode('rent')">ğŸ”‘ ì „ì„¸</button>
      </div>
      <button class="settings-btn" onclick="toggleSettings()">âš™ï¸ ì„¤ì •</button>
    </div>
  </div>
  <div class="marriage-status-bar" id="marriageBar">
    <div style="font-size:12px;font-weight:600;color:var(--text-mid)">ğŸ’ í˜¼ì¸ì‹ ê³ </div>
    <div class="marriage-toggle">
      <button class="marriage-btn active" data-married="1" onclick="setMarriage(true)">ì‹ ê³  ì™„ë£Œ</button>
      <button class="marriage-btn" data-married="0" onclick="setMarriage(false)">ë¯¸ì‹ ê³ </button>
    </div>
    <div class="marriage-info" id="marriageInfo">ë¶€ë¶€í•©ì‚° ì†Œë“ ì ìš© â†’ ì •ì±…ëŒ€ì¶œ ëŒ€ë¶€ë¶„ <strong>ì†Œë“ ì´ˆê³¼</strong></div>
    <div class="marriage-income-badge married" id="marriageIncomeBadge">í•©ì‚° 8,740ë§Œ</div>
  </div>
  <div class="stats-row" id="statsRow">
    <div class="stat-card"><div class="stat-label">í•©ì‚° ì—°ì†Œë“</div><div class="stat-value" id="totalIncome">â€”</div><div class="stat-sub" id="totalIncomeSub">â€”</div></div>
    <div class="stat-card"><div class="stat-label" id="equityLabel">íˆ¬ì… ê°€ëŠ¥ ìê¸°ìê¸ˆ</div><div class="stat-value" id="equity">â€”</div><div class="stat-sub" id="equitySub">â€”</div></div>
    <div class="stat-card"><div class="stat-label" id="mainPriceLabel">ìµœëŒ€ ë§¤ìˆ˜ ê°€ëŠ¥ê°€</div><div class="stat-value" id="maxPrice" style="color:var(--mode-accent)">â€”</div><div class="stat-sub" id="maxPriceSub">â€”</div><div class="stat-bar"><div class="stat-bar-fill" id="maxPriceBar" style="width:0%;background:var(--mode-accent)"></div></div></div>
    <div class="stat-card"><div class="stat-label" id="monthlyLabel">ì›” ìƒí™˜ ì—¬ë ¥</div><div class="stat-value" id="monthlyLeft">â€”</div><div class="stat-sub" id="monthlyLeftSub">â€”</div><div class="stat-bar"><div class="stat-bar-fill" id="monthlyBar" style="width:0%;background:var(--green)"></div></div></div>
  </div>
  <div class="section buy-only" id="loanSectionBuy"><div class="section-header"><div class="section-title">ğŸ¦ ëŒ€ì¶œ í•œë„ ë¶„ì„</div><div class="section-badge" id="loanBadge">ì‹¤ì‹œê°„ ê³„ì‚°</div></div>
    <div class="loan-grid">
      <div class="loan-card" id="ltvCard"><div class="loan-label">LTV ê¸°ì¤€ ìµœëŒ€ ëŒ€ì¶œ</div><div class="loan-big" id="ltvMax">â€”</div><div class="loan-detail" id="ltvDetail">â€”</div></div>
      <div class="loan-card" id="dsrCard"><div class="loan-label">DSR ê¸°ì¤€ ìµœëŒ€ ëŒ€ì¶œ</div><div class="loan-big" id="dsrMax">â€”</div><div class="loan-detail" id="dsrDetail">â€”</div></div>
      <div class="loan-card" id="monthlyCard"><div class="loan-label">ì›” ìƒí™˜ ê¸°ì¤€ ìµœëŒ€ ëŒ€ì¶œ</div><div class="loan-big" id="monthlyMax">â€”</div><div class="loan-detail" id="monthlyDetail">â€”</div></div>
      <div class="loan-card" id="finalCard"><div class="loan-label">âœ… ì‹¤ì œ ê°€ëŠ¥ ëŒ€ì¶œ (ìµœì†Ÿê°’)</div><div class="loan-big" id="finalLoan" style="color:var(--mode-accent)">â€”</div><div class="loan-detail" id="finalDetail">â€”</div></div>
    </div>
  </div>
  <div class="section rent-only" id="loanSectionRent"><div class="section-header"><div class="section-title">ğŸ¦ ì „ì„¸ ëŒ€ì¶œ ë¶„ì„</div><div class="section-badge" id="rentLoanBadge">ì‹¤ì‹œê°„ ê³„ì‚°</div></div>
    <div class="rent-loan-grid">
      <div class="loan-card ok" id="rentLimitCard"><div class="loan-label">ì „ì„¸ëŒ€ì¶œ í•œë„</div><div class="loan-big" id="rentLimitMax">â€”</div><div class="loan-detail" id="rentLimitDetail">â€”</div></div>
      <div class="loan-card" id="rentInterestCard"><div class="loan-label">ì›” ì´ì ë¶€ë‹´</div><div class="loan-big" id="rentInterest">â€”</div><div class="loan-detail" id="rentInterestDetail">â€”</div></div>
      <div class="loan-card ok" id="rentBudgetCard"><div class="loan-label">âœ… ì´ ì „ì„¸ ì˜ˆì‚°</div><div class="loan-big" id="rentBudget" style="color:var(--mode-accent)">â€”</div><div class="loan-detail" id="rentBudgetDetail">â€”</div></div>
    </div>
  </div>
  <div class="section buy-only"><div class="section-header"><div class="section-title">ğŸ” ë§¤ë¬¼ íƒìƒ‰ ì¡°ê±´</div><div class="section-badge">í˜„ì¬ ë°°ì¹˜ ì„¤ì • ê¸°ì¤€</div></div>
    <div class="condition-row"><div class="cond-chip">ğŸ“ 59~84ã¡ (20í‰ëŒ€)</div><div class="cond-chip">ğŸš‡ ì—­ì„¸ê¶Œ ë„ë³´ 15ë¶„ ì´ë‚´</div><div class="cond-chip">ğŸ¢ 200ì„¸ëŒ€ ì´ìƒ</div><div class="cond-chip">ğŸ’° ë§¤ë§¤ê°€ 6ì–µ ì´í•˜</div><div class="cond-chip">ğŸš‹ ì‹ ë¶„ë‹¹ì„  ë¼ì¸</div><div class="cond-chip">ğŸ“ ì„œìš¸ ë™ë‚¨ë¶€ Â· ì„±ë‚¨ Â· ìš©ì¸ Â· ê³¼ì²œ Â· ì•ˆì–‘ Â· í•˜ë‚¨ Â· ê´‘ì£¼</div></div>
  </div>
  <div class="section"><div class="section-header"><div class="section-title">ğŸ”— ë¶€ë™ì‚° ì‚¬ì´íŠ¸ ë°”ë¡œê°€ê¸°</div></div>
    <div class="quick-links">
      <a href="https://new.land.naver.com/" target="_blank" class="quick-link"><span class="ql-icon">ğŸŸ¢</span><span class="ql-name">ë„¤ì´ë²„ ë¶€ë™ì‚°</span><span class="ql-desc">ë§¤ë¬¼ ê²€ìƒ‰ Â· ì‹œì„¸</span></a>
      <a href="https://hogangnono.com/" target="_blank" class="quick-link"><span class="ql-icon">ğŸŸ¡</span><span class="ql-name">í˜¸ê°±ë…¸ë…¸</span><span class="ql-desc">ì‹¤ê±°ë˜ê°€ Â· ë¦¬ë·°</span></a>
      <a href="https://asil.kr/" target="_blank" class="quick-link"><span class="ql-icon">ğŸ”µ</span><span class="ql-name">ì•„ì‹¤</span><span class="ql-desc">ì‹¤ê±°ë˜ê°€ Â· ì‹œì„¸ë¹„êµ</span></a>
      <a href="https://kbland.kr/" target="_blank" class="quick-link"><span class="ql-icon">ğŸŸ </span><span class="ql-name">KBë¶€ë™ì‚°</span><span class="ql-desc">KBì‹œì„¸ Â· ëŒ€ì¶œ</span></a>
      <a href="https://rt.molit.go.kr/" target="_blank" class="quick-link"><span class="ql-icon">ğŸ›ï¸</span><span class="ql-name">êµ­í† ë¶€ ì‹¤ê±°ë˜ê°€</span><span class="ql-desc">ê³µì‹ ê±°ë˜ ë°ì´í„°</span></a>
    </div>
  </div>
  <div class="tab-nav" id="tabNav">
    <button class="tab-btn active" onclick="switchTab('properties')" id="tabBtnProperties">ğŸ“Š ë§¤ë¬¼ ì‹œë®¬ë ˆì´ì…˜</button>
    <button class="tab-btn" onclick="switchTab('map')" id="tabBtnMap">ğŸ—ºï¸ ì§€ë„</button>
    <button class="tab-btn" onclick="switchTab('policy')" id="tabBtnPolicy">ğŸ“œ ì •ì±… Â· ëŒ€ì¶œ</button>
  </div>
  <div class="tab-content active" id="tab-properties">
    <div class="buy-only"><div class="section" style="margin-top:0"><div class="section-header"><div class="section-title">ğŸ˜ï¸ ê´€ì‹¬ ë§¤ë¬¼ ì‹œë®¬ë ˆì´ì…˜</div><div class="section-badge" id="propertyBadge">ë°ì´í„° ì—†ìŒ</div></div>
      <div class="table-controls"><input type="text" class="search-input" id="searchInput" placeholder="ë‹¨ì§€ëª…, ì§€ì—­, ë™ ê²€ìƒ‰..."><select class="filter-select" id="regionFilter"><option value="">ì „ì²´ ì§€ì—­</option></select></div>
      <div class="filter-row"><span class="filter-label">íŒì •</span><div class="filter-chip-group" id="verdictChips"><button class="filter-chip active" data-val="" onclick="setVerdictFilter(this)">ì „ì²´</button><button class="filter-chip" data-val="ë§¤ìˆ˜ê°€ëŠ¥" onclick="setVerdictFilter(this)">âœ… ë§¤ìˆ˜ê°€ëŠ¥</button><button class="filter-chip" data-val="ë¹ ë“¯í•¨" onclick="setVerdictFilter(this)">âš ï¸ ë¹ ë“¯í•¨</button><button class="filter-chip" data-val="ìƒí™˜ì´ˆê³¼" onclick="setVerdictFilter(this)">ğŸ”´ ìƒí™˜ì´ˆê³¼</button><button class="filter-chip" data-val="ìê¸ˆë¶€ì¡±" onclick="setVerdictFilter(this)">ğŸ”´ ìê¸ˆë¶€ì¡±</button></div></div>
      <div class="filter-row"><span class="filter-label">ì •ë ¬</span><div class="filter-chip-group"><button class="filter-chip active" data-sort="price-asc" onclick="setSort(this)">ê°€ê²©â†‘</button><button class="filter-chip" data-sort="price-desc" onclick="setSort(this)">ê°€ê²©â†“</button><button class="filter-chip" data-sort="walk" onclick="setSort(this)">ì—­ì„¸ê¶Œìˆœ</button></div></div>
      <div class="table-wrap"><table><thead><tr><th class="col-name">ë‹¨ì§€ëª…</th><th class="col-region">ì§€ì—­</th><th class="col-area"><span class="area-toggle" onclick="toggleAreaUnit()" title="í´ë¦­í•˜ì—¬ ì „í™˜">ë©´ì  <span id="areaUnitLabel">í‰</span></span></th><th class="col-price">ë§¤ë§¤ê°€</th><th class="col-equity">í•„ìš”ìê¸ˆ</th><th class="col-loan">ëŒ€ì¶œì•¡</th><th class="col-monthly">ì›”ìƒí™˜</th><th class="col-verdict">íŒì •</th><th class="col-link">ë§í¬</th></tr></thead><tbody id="propertyBody"></tbody></table></div>
      <div class="pagination-bar"><div style="display:flex;align-items:center;gap:8px;"><span>í‘œì‹œ ê±´ìˆ˜</span><select class="page-size-select" id="pageSizeSelect" onchange="changePageSize(this.value)"><option value="20" selected>20ê°œ</option><option value="30">30ê°œ</option><option value="40">40ê°œ</option><option value="50">50ê°œ</option></select></div><div class="page-info" id="pageInfo"></div><div class="page-btns" id="pageBtns"></div></div>
    </div></div>
    <div class="rent-only" id="rentPropertySection">
      <!-- ì „ì„¸ ë°ì´í„° ìˆì„ ë•Œ í‘œì‹œë˜ëŠ” í…Œì´ë¸” -->
      <div id="rentTableWrap" style="display:none"><div class="section" style="margin-top:0"><div class="section-header"><div class="section-title">ğŸ”‘ ì „ì„¸ ì‹¤ê±°ë˜ í˜„í™©</div><div class="section-badge" id="rentPropertyBadge">ë°ì´í„° ì—†ìŒ</div></div>
        <div class="table-controls"><input type="text" class="search-input" id="rentSearchInput" placeholder="ë‹¨ì§€ëª…, ì§€ì—­, ë™ ê²€ìƒ‰..."><select class="filter-select" id="rentRegionFilter"><option value="">ì „ì²´ ì§€ì—­</option></select></div>
        <div class="filter-row"><span class="filter-label">ìœ í˜•</span><div class="filter-chip-group" id="rentTypeChips"><button class="filter-chip active" data-val="" onclick="setRentTypeFilter(this)">ì „ì²´</button><button class="filter-chip" data-val="ì „ì„¸" onclick="setRentTypeFilter(this)">ğŸ”‘ ì „ì„¸</button><button class="filter-chip" data-val="ì›”ì„¸" onclick="setRentTypeFilter(this)">ğŸ’³ ì›”ì„¸</button></div></div>
        <div class="filter-row"><span class="filter-label">íŒì •</span><div class="filter-chip-group" id="rentVerdictChips"><button class="filter-chip active" data-val="" onclick="setRentVerdictFilter(this)">ì „ì²´</button><button class="filter-chip" data-val="ê°€ëŠ¥" onclick="setRentVerdictFilter(this)">âœ… ê°€ëŠ¥</button><button class="filter-chip" data-val="ë¹ ë“¯í•¨" onclick="setRentVerdictFilter(this)">âš ï¸ ë¹ ë“¯í•¨</button><button class="filter-chip" data-val="ì˜ˆì‚°ì´ˆê³¼" onclick="setRentVerdictFilter(this)">ğŸ”´ ì˜ˆì‚°ì´ˆê³¼</button></div></div>
        <div class="filter-row"><span class="filter-label">ì •ë ¬</span><div class="filter-chip-group"><button class="filter-chip active" data-sort="price-asc" onclick="setRentSort(this)">ë³´ì¦ê¸ˆâ†‘</button><button class="filter-chip" data-sort="price-desc" onclick="setRentSort(this)">ë³´ì¦ê¸ˆâ†“</button><button class="filter-chip" data-sort="walk" onclick="setRentSort(this)">ì—­ì„¸ê¶Œìˆœ</button></div></div>
        <div class="table-wrap"><table><thead><tr><th class="col-name">ë‹¨ì§€ëª…</th><th class="col-region">ì§€ì—­</th><th class="col-area">ë©´ì </th><th style="min-width:50px">ìœ í˜•</th><th class="col-price">ë³´ì¦ê¸ˆ</th><th style="min-width:60px">ì›”ì„¸</th><th class="col-verdict">íŒì •</th><th class="col-link">ë§í¬</th></tr></thead><tbody id="rentPropertyBody"></tbody></table></div>
        <div class="pagination-bar"><div style="display:flex;align-items:center;gap:8px;"><span>í‘œì‹œ ê±´ìˆ˜</span><select class="page-size-select" id="rentPageSizeSelect" onchange="changeRentPageSize(this.value)"><option value="20" selected>20ê°œ</option><option value="30">30ê°œ</option><option value="40">40ê°œ</option><option value="50">50ê°œ</option></select></div><div class="page-info" id="rentPageInfo"></div><div class="page-btns" id="rentPageBtns"></div></div>
      </div></div>
      <!-- ì „ì„¸ ë°ì´í„° ì—†ì„ ë•Œ í‘œì‹œë˜ëŠ” í”Œë ˆì´ìŠ¤í™€ë” -->
      <div class="rent-placeholder" id="rentPlaceholder"><div class="rent-placeholder-icon">ğŸ”‘</div><div class="rent-placeholder-title">ì „ì„¸ ë§¤ë¬¼ ë°ì´í„° ì¤€ë¹„ ì¤‘</div><div class="rent-placeholder-desc">ì „ì›”ì„¸ ì‹¤ê±°ë˜ ë°ì´í„° íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶• ì¤‘ì…ë‹ˆë‹¤.<br>í˜„ì¬ëŠ” ìœ„ ì‹œë®¬ë ˆì´í„°ì™€ ì •ì±…ëŒ€ì¶œ íƒ­ìœ¼ë¡œ ì „ì„¸ ì˜ˆì‚°ì„ ë¶„ì„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>ì•„ë˜ ì‚¬ì´íŠ¸ì—ì„œ ì „ì„¸ ë§¤ë¬¼ì„ ì§ì ‘ íƒìƒ‰í•´ë³´ì„¸ìš”.</div>
        <div class="rent-placeholder-links"><a href="https://new.land.naver.com/" target="_blank" class="quick-link" style="flex:none"><span class="ql-icon">ğŸŸ¢</span><span class="ql-name">ë„¤ì´ë²„ ì „ì„¸</span></a><a href="https://hogangnono.com/" target="_blank" class="quick-link" style="flex:none"><span class="ql-icon">ğŸŸ¡</span><span class="ql-name">í˜¸ê°±ë…¸ë…¸ ì „ì„¸</span></a><a href="https://asil.kr/" target="_blank" class="quick-link" style="flex:none"><span class="ql-icon">ğŸ”µ</span><span class="ql-name">ì•„ì‹¤ ì „ì„¸</span></a></div>
      </div>
    </div>
  </div>
  <div class="tab-content" id="tab-map">
    <div class="section" style="margin-top:0">
      <div class="section-header"><div class="section-title">ğŸ—ºï¸ ë§¤ë¬¼ ìœ„ì¹˜ ì§€ë„</div><div class="section-badge" id="mapBadge">ë¡œë”© ì¤‘...</div></div>
      <div class="filter-row"><span class="filter-label">í‘œì‹œ</span><div class="filter-chip-group" id="mapVerdictChips">
        <button class="filter-chip active" data-val="" onclick="setMapFilter(this)">ì „ì²´</button>
        <button class="filter-chip" data-val="ok" onclick="setMapFilter(this)">âœ… ê°€ëŠ¥</button>
        <button class="filter-chip" data-val="warn" onclick="setMapFilter(this)">âš ï¸ ë¹ ë“¯í•¨</button>
        <button class="filter-chip" data-val="danger" onclick="setMapFilter(this)">ğŸ”´ ë¶ˆê°€</button>
      </div></div>
      <div id="mapContainer" style="width:100%;height:500px;border-radius:10px;border:1px solid var(--border);background:var(--surface2)"></div>
      <div style="font-size:10px;color:var(--text-dim);margin-top:6px;display:flex;gap:12px;flex-wrap:wrap">
        <span>ğŸŸ¢ ë§¤ìˆ˜/ì „ì„¸ ê°€ëŠ¥</span><span>ğŸŸ¡ ë¹ ë“¯í•¨</span><span>ğŸ”´ ìê¸ˆë¶€ì¡±/ì˜ˆì‚°ì´ˆê³¼</span><span>ğŸ”µ ì—­ ìœ„ì¹˜</span>
      </div>
    </div>
  </div>
  <div class="tab-content" id="tab-policy">
    <div class="section" style="margin-top:0"><div class="section-header"><div class="section-title">ğŸ“œ ìµœê·¼ ì •ì±… ë³€ë™</div><div class="section-badge">ì˜í–¥ë„ ë¶„ì„</div></div>
      <div class="timeline" id="policyTimeline"></div>
    </div>
    <div class="section"><div class="section-header"><div class="section-title">ğŸ¯ ì •ì±…ëŒ€ì¶œ ìê²© ì²´í¬</div><div class="section-badge" id="policyBadge">ì†Œë“ ì—°ë™ ìë™ íŒì •</div></div>
      <div style="font-size:11px;color:var(--text-dim);margin-bottom:10px" id="policyDateLabel">ğŸ“… ê¸°ì¤€: 2026ë…„ 2ì›” Â· ì¶œì²˜: ì£¼íƒë„ì‹œê¸°ê¸ˆÂ·í•œêµ­ì£¼íƒê¸ˆìœµê³µì‚¬ ê³µì‹œ</div>
      <div class="policy-grid" id="policyGrid"></div>
    </div>
  </div>
  <div class="footer">ì„¤ì •(âš™ï¸)ì—ì„œ ì†Œë“Â·ìê¸ˆÂ·ëŒ€ì¶œ ì¡°ê±´ì„ ë³€ê²½í•˜ë©´ ëª¨ë“  ìˆ«ìê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¬ê³„ì‚°ë©ë‹ˆë‹¤</div>
</div>
<!-- Settings Overlay -->
<div class="settings-overlay" id="settingsOverlay" onclick="closeSettingsOutside(event)">
  <div class="settings-panel" onclick="event.stopPropagation()">
    <button class="settings-close" onclick="toggleSettings()">âœ•</button>
    <div class="settings-title">âš™ï¸ ì‹œë®¬ë ˆì´ì…˜ ì„¤ì •</div>
    <div class="section-label">ğŸ‘« ê°€êµ¬ ì†Œë“</div>
    <div class="field"><label>ë³¸ì¸ ì—°ì†Œë“</label><div class="field-row"><input type="range" id="income1" min="2000" max="10000" step="100" value="4740"><input type="number" class="field-value" id="income1Val" value="4740" min="0" max="99999"><span class="field-unit">ë§Œì›</span></div></div>
    <div class="field"><label>ë°°ìš°ì ì—°ì†Œë“</label><div class="field-row"><input type="range" id="income2" min="2000" max="10000" step="100" value="4000"><input type="number" class="field-value" id="income2Val" value="4000" min="0" max="99999"><span class="field-unit">ë§Œì›</span></div></div>
    <div class="section-label">ğŸ’° ìê¸ˆ í˜„í™©</div>
    <div class="field"><label>ì´ ê°€ìš© ìê¸ˆ</label><div class="field-row"><input type="range" id="cash" min="3000" max="30000" step="500" value="15000"><input type="number" class="field-value" id="cashVal" value="15000" min="0" max="999999"><span class="field-unit">ë§Œì›</span></div></div>
    <div class="field buy-only"><label>ì¸í…Œë¦¬ì–´ ì˜ˆì‚°</label><div class="field-row"><input type="range" id="interior" min="0" max="15000" step="500" value="5000"><input type="number" class="field-value" id="interiorVal" value="5000" min="0" max="999999"><span class="field-unit">ë§Œì›</span></div></div>
    <div class="buy-only">
      <div class="section-label">ğŸ¦ ë§¤ìˆ˜ ëŒ€ì¶œ ì¡°ê±´</div>
      <div class="field"><label>ì˜ˆìƒ ê¸ˆë¦¬</label><div class="field-row"><input type="range" id="rate" min="2.0" max="6.0" step="0.1" value="4.0"><input type="number" class="field-value" id="rateVal" value="4.0" min="0" max="20" step="0.1"><span class="field-unit">%</span></div></div>
      <div class="field"><label>ëŒ€ì¶œ ë§Œê¸°</label><div class="field-row"><input type="range" id="term" min="10" max="40" step="5" value="30"><input type="number" class="field-value" id="termVal" value="30" min="1" max="50"><span class="field-unit">ë…„</span></div></div>
      <div class="field"><label>ì›” ìƒí™˜ í•œë„ (ê´€ë¦¬ë¹„ í¬í•¨)</label><div class="field-row"><input type="range" id="monthlyLimit" min="100" max="400" step="10" value="200"><input type="number" class="field-value" id="monthlyLimitVal" value="200" min="0" max="9999"><span class="field-unit">ë§Œì›</span></div></div>
      <div class="field"><label>ê´€ë¦¬ë¹„ ì˜ˆìƒ</label><div class="field-row"><input type="range" id="mgmt" min="10" max="60" step="5" value="35"><input type="number" class="field-value" id="mgmtVal" value="35" min="0" max="999"><span class="field-unit">ë§Œì›</span></div></div>
      <div class="section-label">ğŸ“ ê·œì œ ì„¤ì • <span style="font-size:9px;color:var(--accent);letter-spacing:0">â† ì •ë¶€ ì •ì±…</span></div>
      <div class="policy-ref"><div class="policy-ref-title">í˜„í–‰ LTV ê¸°ì¤€</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--green)"></span> ë¹„ê·œì œ: 70%</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--yellow)"></span> ì¡°ì •ëŒ€ìƒ: 50%</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--red)"></span> íˆ¬ê¸°ê³¼ì—´: 40%</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--blue)"></span> ìƒì• ìµœì´ˆ: 80% (íŠ¹ë¡€)</div></div>
      <div class="field"><label>ì ìš© LTV <span class="field-hint">ì‹œë®¬ë ˆì´ì…˜ìš©</span></label><div class="field-row"><input type="range" id="ltv" min="0" max="80" step="5" value="70"><input type="number" class="field-value" id="ltvVal" value="70" min="0" max="100"><span class="field-unit">%</span></div></div>
      <div class="policy-ref" style="margin-top:10px"><div class="policy-ref-title">í˜„í–‰ DSR ê¸°ì¤€</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--text-mid)"></span> ì „ ê¸ˆìœµê¶Œ: 40%</div></div>
      <div class="field"><label>ì ìš© DSR <span class="field-hint">ì‹œë®¬ë ˆì´ì…˜ìš©</span></label><div class="field-row"><input type="range" id="dsr" min="20" max="60" step="5" value="40"><input type="number" class="field-value" id="dsrVal" value="40" min="0" max="100"><span class="field-unit">%</span></div></div>
    </div>
    <div class="rent-only">
      <div class="section-label">ğŸ¦ ì „ì„¸ ëŒ€ì¶œ ì¡°ê±´</div>
      <div class="field"><label>ì „ì„¸ëŒ€ì¶œ ìœ í˜•</label><select id="rentLoanType" onchange="onRentTypeChange()"><option value="bank" selected>ì‹œì¤‘ì€í–‰ ì „ì„¸ëŒ€ì¶œ</option><option value="policy">ì •ì±…ëŒ€ì¶œ (ë²„íŒ€ëª© ë“±)</option></select></div>
      <div class="policy-ref" id="rentTypeRef"><div class="policy-ref-title">ì‹œì¤‘ì€í–‰ ì „ì„¸ëŒ€ì¶œ ê¸°ì¤€</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--yellow)"></span> ê¸ˆë¦¬: 3.3~4.5%</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--blue)"></span> í•œë„: ë³´ì¦í•œë„ ë‚´ (HUG/HF/SGI)</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--text-mid)"></span> DSR ë¯¸ì ìš©, ì†Œë“ ì œí•œ ì—†ìŒ</div></div>
      <div class="field"><label>ì „ì„¸ëŒ€ì¶œ ê¸ˆë¦¬</label><div class="field-row"><input type="range" id="rentRate" min="1.0" max="6.0" step="0.1" value="3.8"><input type="number" class="field-value" id="rentRateVal" value="3.8" min="0" max="20" step="0.1"><span class="field-unit">%</span></div></div>
      <div class="field"><label>ë³´ì¦ê¸ˆ ëŒ€ë¹„ ëŒ€ì¶œë¹„ìœ¨</label><div class="field-row"><input type="range" id="rentLoanRatio" min="50" max="100" step="5" value="80"><input type="number" class="field-value" id="rentLoanRatioVal" value="80" min="0" max="100"><span class="field-unit">%</span></div></div>
      <div class="field"><label>ì „ì„¸ëŒ€ì¶œ í•œë„</label><div class="field-row"><input type="range" id="rentLoanLimit" min="5000" max="50000" step="1000" value="30000"><input type="number" class="field-value" id="rentLoanLimitVal" value="30000" min="0" max="999999"><span class="field-unit">ë§Œì›</span></div></div>
    </div>
    <div class="section-label">ğŸ˜ï¸ ì£¼íƒ ìƒíƒœ</div>
    <div class="field"><label>í˜„ì¬ ì£¼íƒ ìˆ˜</label><select id="houseCount"><option value="0">ë¬´ì£¼íƒ</option><option value="1" selected>1ì£¼íƒ (ëŒ€êµ¬)</option><option value="2">2ì£¼íƒ ì´ìƒ</option></select></div>
  </div>
</div>
<script>
let currentMode='buy',isMarried=true,PROPERTIES=[],RENT_PROPERTIES=[],DATA_LOADED=false,RENT_DATA_LOADED=false,DATA_UPDATED_AT='',RENT_UPDATED_AT='',currentSort='price-asc',rentSort='price-asc',searchQuery='',regionFilterVal='',verdictFilterVal='',rentTypeFilterVal='',rentVerdictFilterVal='',areaUnit='py',pageSize=20,currentPage=1,rentPage=1;

function setMarriage(married){
  isMarried=married;
  document.querySelectorAll('.marriage-btn').forEach(b=>b.classList.toggle('active', (b.dataset.married==='1')===married));
  updateMarriageBar();
  if(currentMode==='rent'){if(married){document.getElementById('rentLoanType').value='bank';onRentTypeChange();}}
  update();
}
function updateMarriageBar(){
  const i1=getVal('income1'),i2=getVal('income2'),ti=i1+i2,mi=Math.min(i1,i2);
  const info=document.getElementById('marriageInfo'),badge=document.getElementById('marriageIncomeBadge');
  if(isMarried){info.innerHTML='ë¶€ë¶€í•©ì‚° ì†Œë“ ì ìš© â†’ ì •ì±…ëŒ€ì¶œ ëŒ€ë¶€ë¶„ <strong>ì†Œë“ ì´ˆê³¼</strong>';badge.textContent='í•©ì‚° '+fmtShort(ti);badge.className='marriage-income-badge married';}
  else{info.innerHTML='ë‹¨ë… ì†Œë“ ì ìš© ê°€ëŠ¥ â†’ ë°°ìš°ì('+fmtShort(mi)+') ê¸°ì¤€ ì •ì±…ëŒ€ì¶œ <strong>ìê²© ê°€ëŠ¥</strong>';badge.textContent='ë‹¨ë… '+fmtShort(mi);badge.className='marriage-income-badge single';}
}
function applyTheme(mode){
  const themes={buy:{accent:'#2563eb',accentLight:'#eff6ff',bg:'#f0f4ff',border:'#dbe4f0',stripe:'#2563eb'},rent:{accent:'#059669',accentLight:'#ecfdf5',bg:'#f0faf6',border:'#d1e7dd',stripe:'#059669'}};
  const t=themes[mode],r=document.documentElement.style;
  r.setProperty('--mode-accent',t.accent);r.setProperty('--mode-accent-light',t.accentLight);r.setProperty('--mode-bg',t.bg);r.setProperty('--mode-border',t.border);r.setProperty('--mode-header-stripe',t.stripe);
}
function switchMode(mode){
  currentMode=mode;
  applyTheme(mode);
  document.querySelectorAll('.mode-btn').forEach(b=>b.classList.toggle('active',b.dataset.mode===mode));
  document.body.classList.toggle('mode-rent',mode==='rent');
  document.getElementById('logoText').textContent=mode==='buy'?'ğŸ  ìš°ë¦¬ ì§‘ ì‚¬ê¸°':'ğŸ”‘ ìš°ë¦¬ ì§‘ êµ¬í•˜ê¸°';
  const tabBtnProp=document.getElementById('tabBtnProperties');
  if(mode==='rent'){
    if(RENT_DATA_LOADED&&RENT_PROPERTIES.length>0){tabBtnProp.style.display='';tabBtnProp.textContent='ğŸ“Š ì „ì„¸ ì‹¤ê±°ë˜';switchTab('properties');}
    else{tabBtnProp.style.display='none';switchTab('policy');}
  }else{tabBtnProp.style.display='';tabBtnProp.textContent='ğŸ“Š ë§¤ë¬¼ ì‹œë®¬ë ˆì´ì…˜';}
  update();
}
function toggleSettings(){document.getElementById('settingsOverlay').classList.toggle('open')}
function closeSettingsOutside(e){if(e.target===document.getElementById('settingsOverlay'))toggleSettings()}
function onRentTypeChange(){
  const type=document.getElementById('rentLoanType').value,ref=document.getElementById('rentTypeRef');
  if(type==='policy'){
    ref.innerHTML='<div class="policy-ref-title">ì •ì±…ëŒ€ì¶œ ê¸°ì¤€ (ë²„íŒ€ëª© ë“±)</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--green)"></span> ê¸ˆë¦¬: 1.5~3.5%</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--blue)"></span> í•œë„: ìˆ˜ë„ê¶Œ ìµœëŒ€ 2.5ì–µ (ë³´ì¦ê¸ˆ 80%)</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--text-mid)"></span> DSR ë¯¸ì ìš©</div>'+(isMarried?'<div class="policy-ref-row" style="color:var(--red)"><span class="ref-dot" style="background:var(--red)"></span> âš ï¸ í•©ì‚° ì†Œë“ ì´ˆê³¼ë¡œ ëŒ€ë¶€ë¶„ íƒˆë½</div>':'<div class="policy-ref-row" style="color:var(--green)"><span class="ref-dot" style="background:var(--green)"></span> âœ… ë‹¨ë… ì†Œë“ ê¸°ì¤€ ìê²© ê°€ëŠ¥</div>');
    setRV('rentRate',2.5);setRV('rentLoanRatio',80);setRV('rentLoanLimit',20000);
  }else{
    ref.innerHTML='<div class="policy-ref-title">ì‹œì¤‘ì€í–‰ ì „ì„¸ëŒ€ì¶œ ê¸°ì¤€</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--yellow)"></span> ê¸ˆë¦¬: 3.3~4.5%</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--blue)"></span> í•œë„: ë³´ì¦í•œë„ ë‚´ (HUG/HF/SGI)</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--text-mid)"></span> DSR ë¯¸ì ìš©, ì†Œë“ ì œí•œ ì—†ìŒ</div>';
    setRV('rentRate',3.8);setRV('rentLoanRatio',80);setRV('rentLoanLimit',30000);
  }
  update();
}
function setRV(id,v){const s=document.getElementById(id),i=document.getElementById(id+'Val');if(s)s.value=v;if(i)i.value=v;}
function toggleAreaUnit(){areaUnit=areaUnit==='py'?'m2':'py';document.getElementById('areaUnitLabel').textContent=areaUnit==='py'?'í‰':'ã¡';update();}
function fmtArea(p){return areaUnit==='py'?(p.area_py?p.area_py+'í‰':p.area):p.area;}
function toggleHistory(btn){const h=btn.nextElementSibling;if(h&&h.classList.contains('trade-history')){h.classList.toggle('open');btn.textContent=h.classList.contains('open')?'â–¼ ê±°ë˜ë‚´ì—­ ì ‘ê¸°':'â–¶ ê±°ë˜ë‚´ì—­ '+h.querySelectorAll('.trade-row').length+'ê±´';}}
function switchTab(tabId){
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
  document.getElementById('tab-'+tabId).classList.add('active');
  if(tabId==='properties')document.getElementById('tabBtnProperties').classList.add('active');
  else if(tabId==='map'){document.getElementById('tabBtnMap').classList.add('active');initMapIfNeeded();}
  else document.getElementById('tabBtnPolicy').classList.add('active');
}
function changePageSize(v){pageSize=parseInt(v);currentPage=1;update();}
function changeRentPageSize(v){pageSize=parseInt(v);rentPage=1;update();}
function getVal(id){const i=document.getElementById(id+'Val');if(i&&i.value!=='')return parseFloat(i.value);const e=document.getElementById(id);return e?parseFloat(e.value):0;}
function fmtShort(n){if(n>=10000){const u=Math.floor(n/10000),m=n%10000;return m===0?u+'ì–µ':u+'ì–µ '+m.toLocaleString()+'ë§Œ';}return n.toLocaleString()+'ë§Œ';}
function monthlyPayment(p,r,y){if(p<=0)return 0;const mr=r/100/12,n=y*12;if(mr===0)return p/n;return p*mr*Math.pow(1+mr,n)/(Math.pow(1+mr,n)-1);}
function maxLoanFromMonthly(m,r,y){const mr=r/100/12,n=y*12;if(mr===0)return m*n;return m*(Math.pow(1+mr,n)-1)/(mr*Math.pow(1+mr,n));}
function makeLinks(p){const q=encodeURIComponent((p.dong||'')+' '+p.name);return '<a href="https://m.land.naver.com/search/result/'+q+'" target="_blank" class="link-icon" title="ë„¤ì´ë²„ ë¶€ë™ì‚°">N</a><a href="https://hogangnono.com/search/'+encodeURIComponent(p.name)+'" target="_blank" class="link-icon" title="í˜¸ê°±ë…¸ë…¸">H</a>';}
function setSort(btn){btn.closest('.filter-chip-group').querySelectorAll('.filter-chip').forEach(b=>b.classList.remove('active'));btn.classList.add('active');currentSort=btn.dataset.sort;currentPage=1;update();}
function setRentSort(btn){btn.closest('.filter-chip-group').querySelectorAll('.filter-chip').forEach(b=>b.classList.remove('active'));btn.classList.add('active');rentSort=btn.dataset.sort;rentPage=1;update();}
function setVerdictFilter(btn){document.querySelectorAll('#verdictChips .filter-chip').forEach(b=>b.classList.remove('active'));btn.classList.add('active');verdictFilterVal=btn.dataset.val;currentPage=1;update();}
function setRentTypeFilter(btn){document.querySelectorAll('#rentTypeChips .filter-chip').forEach(b=>b.classList.remove('active'));btn.classList.add('active');rentTypeFilterVal=btn.dataset.val;rentPage=1;update();}
function setRentVerdictFilter(btn){document.querySelectorAll('#rentVerdictChips .filter-chip').forEach(b=>b.classList.remove('active'));btn.classList.add('active');rentVerdictFilterVal=btn.dataset.val;rentPage=1;update();}

async function loadSettings(){
  try{const r=await fetch('settings.json');if(!r.ok)throw 0;const s=await r.json();
  ['income1','income2','cash','interior','rate','term','monthlyLimit','mgmt','ltv','dsr'].forEach(id=>{if(s[id]!==undefined){const sl=document.getElementById(id),ip=document.getElementById(id+'Val');if(sl)sl.value=s[id];if(ip)ip.value=s[id];}});
  if(s.houseCount!==undefined)document.getElementById('houseCount').value=s.houseCount;
  if(s.married!==undefined){isMarried=s.married;document.querySelectorAll('.marriage-btn').forEach(b=>b.classList.toggle('active',(b.dataset.married==='1')===isMarried));}
  }catch(e){console.warn('settings.json ì—†ìŒ, ê¸°ë³¸ê°’ ì‚¬ìš©');}
}
function groupProperties(raw){
  const g={};raw.forEach(i=>{const k=i.region+'_'+i.name+'_'+i.area_m2;if(!g[k])g[k]={name:i.name,region:i.region,area:Math.round(i.area_m2)+'ã¡',area_py:i.area_py,regulated:i.regulated||false,station:i.walk_min?'ë„ë³´ '+i.walk_min+'ë¶„':'ì—­ì •ë³´ ì—†ìŒ',station_name:i.station||'',line:i.line||'',walk_min:i.walk_min,dong:i.dong||'',built_year:i.built_year||0,households:i.households||0,link:i.link||'',lat:i.lat||null,lon:i.lon||null,prices:[],floors:[],dates:[],trades:[]};g[k].prices.push(i.price);g[k].floors.push(i.floor);g[k].dates.push(i.trade_date);g[k].trades.push({price:i.price,floor:i.floor,date:i.trade_date});});
  return Object.values(g).map(v=>{const avg=Math.round(v.prices.reduce((a,b)=>a+b,0)/v.prices.length);const tr=v.trades.sort((a,b)=>(b.date||'').localeCompare(a.date||''));return{name:v.name,region:v.region,area:v.area,area_py:v.area_py,price:avg,regulated:v.regulated,station:v.station,station_name:v.station_name,line:v.line,walk_min:v.walk_min,dong:v.dong,built_year:v.built_year,households:v.households,link:v.link,lat:v.lat,lon:v.lon,trade_count:v.prices.length,min_price:Math.min(...v.prices),max_price:Math.max(...v.prices),latest_date:v.dates.sort().reverse()[0]||'',price_per_py:v.area_py>0?Math.round(avg/v.area_py):0,trades:tr};}).sort((a,b)=>a.price-b.price);
}
function groupRentProperties(raw){
  const g={};raw.forEach(i=>{const k=i.region+'_'+i.name+'_'+i.area_m2+'_'+(i.rent_type||'ì „ì„¸');if(!g[k])g[k]={name:i.name,region:i.region,area:Math.round(i.area_m2)+'ã¡',area_py:i.area_py,rent_type:i.rent_type||'ì „ì„¸',station:i.walk_min?'ë„ë³´ '+i.walk_min+'ë¶„':'ì—­ì •ë³´ ì—†ìŒ',station_name:i.station||'',line:i.line||'',walk_min:i.walk_min,dong:i.dong||'',built_year:i.built_year||0,households:i.households||0,lat:i.lat||null,lon:i.lon||null,deposits:[],monthlys:[],floors:[],dates:[],trades:[]};g[k].deposits.push(i.deposit||0);g[k].monthlys.push(i.monthly_rent||0);g[k].floors.push(i.floor);g[k].dates.push(i.trade_date);g[k].trades.push({deposit:i.deposit||0,monthly:i.monthly_rent||0,floor:i.floor,date:i.trade_date});});
  return Object.values(g).map(v=>{const avgD=Math.round(v.deposits.reduce((a,b)=>a+b,0)/v.deposits.length);const avgM=Math.round(v.monthlys.reduce((a,b)=>a+b,0)/v.monthlys.length);const tr=v.trades.sort((a,b)=>(b.date||'').localeCompare(a.date||''));return{name:v.name,region:v.region,area:v.area,area_py:v.area_py,rent_type:v.rent_type,deposit:avgD,monthly_rent:avgM,station:v.station,station_name:v.station_name,line:v.line,walk_min:v.walk_min,dong:v.dong,built_year:v.built_year,households:v.households,lat:v.lat,lon:v.lon,trade_count:v.deposits.length,min_deposit:Math.min(...v.deposits),max_deposit:Math.max(...v.deposits),latest_date:v.dates.sort().reverse()[0]||'',trades:tr};}).sort((a,b)=>a.deposit-b.deposit);
}
async function loadData(){
  let coordCache={};
  try{const cr=await fetch('coord_cache.json');if(cr.ok)coordCache=await cr.json();}catch(e){}
  try{const r=await fetch('data.json');if(!r.ok)throw 0;const d=await r.json();DATA_UPDATED_AT=d.updated_at||'';PROPERTIES=groupProperties(d.properties||[]);DATA_LOADED=true;
  const regions=[...new Set(PROPERTIES.map(p=>p.region))].sort();const sel=document.getElementById('regionFilter');regions.forEach(r=>{const o=document.createElement('option');o.value=r;o.textContent=r;sel.appendChild(o);});
  }catch(e){PROPERTIES=[];DATA_LOADED=false;}
  try{const r=await fetch('data-rent.json');if(!r.ok)throw 0;const d=await r.json();RENT_UPDATED_AT=d.updated_at||'';RENT_PROPERTIES=groupRentProperties(d.properties||[]);RENT_DATA_LOADED=RENT_PROPERTIES.length>0;
  if(RENT_DATA_LOADED){const rr=[...new Set(RENT_PROPERTIES.map(p=>p.region))].sort();const s1=document.getElementById('regionFilter'),s2=document.getElementById('rentRegionFilter');rr.forEach(r=>{if(![...s1.options].some(o=>o.value===r)){const o=document.createElement('option');o.value=r;o.textContent=r;s1.appendChild(o);}const o2=document.createElement('option');o2.value=r;o2.textContent=r;s2.appendChild(o2);});}
  }catch(e){RENT_PROPERTIES=[];RENT_DATA_LOADED=false;}
  // coord_cache ì¢Œí‘œ ë§¤í•‘ (dong+name ë§¤ì¹­)
  if(Object.keys(coordCache).length>0){
    const ccEntries=Object.entries(coordCache);
    [PROPERTIES,RENT_PROPERTIES].forEach(props=>{
      props.forEach(p=>{
        if(p.lat&&p.lon)return;
        const suffix=p.dong+' '+p.name;
        for(const[k,v]of ccEntries){if(k.endsWith(suffix)){p.lat=v.lat;p.lon=v.lon;break;}}
      });
    });
  }
  update();
}
function update(){
  if(currentMode==='buy')updateBuy();else updateRent();
  updatePolicy();updatePolicyTimeline();updateStatus();updateMarriageBar();
  if(mapInitialized)updateMapMarkers();
}
function updateStatus(){
  const s=document.getElementById('dataStatus');
  if(currentMode==='buy'){if(DATA_LOADED){s.textContent='ğŸ“Š '+PROPERTIES.length+'ê°œ ë‹¨ì§€ Â· ê°±ì‹ : '+DATA_UPDATED_AT;s.style.color='var(--green)';}else{s.textContent='âš ï¸ ë°°ì¹˜ ì‹¤í–‰ í›„ ë°ì´í„° í‘œì‹œ';s.style.color='var(--yellow)';}}
  else{if(RENT_DATA_LOADED){s.textContent='ğŸ”‘ ì „ì„¸ '+RENT_PROPERTIES.length+'ê°œ ë‹¨ì§€ Â· ê°±ì‹ : '+RENT_UPDATED_AT;s.style.color='var(--green)';}else{s.textContent='ğŸ”‘ ì „ì„¸ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ Â· ì‹¤ê±°ë˜ ë°ì´í„° ëŒ€ê¸° ì¤‘';s.style.color='var(--accent2)';}}
}
function updateBuy(){
  const i1=getVal('income1'),i2=getVal('income2'),ti=i1+i2,cash=getVal('cash'),interior=getVal('interior'),eq=Math.max(0,cash-interior);
  const rate=getVal('rate'),term=getVal('term'),ml=getVal('monthlyLimit'),mg=getVal('mgmt'),lp=getVal('ltv'),dp=getVal('dsr'),hc=parseInt(document.getElementById('houseCount').value),mr=ml-mg;
  const arm=ti*dp/100,mrd=arm/12,dsrL=Math.floor(maxLoanFromMonthly(mrd,rate,term)),mlL=Math.floor(maxLoanFromMonthly(mr,rate,term));
  let ltvL,eLTV=lp;if(hc>=2){eLTV=0;ltvL=0;}else if(lp>=100||lp<=0){ltvL=0;}else{ltvL=Math.floor(eq/(1-lp/100)*lp/100);}
  const fL=Math.min(dsrL,mlL,ltvL),fM=Math.floor(monthlyPayment(fL,rate,term)),mpp=fL+eq;
  document.getElementById('totalIncome').textContent=fmtShort(ti);document.getElementById('totalIncomeSub').textContent='ë³¸ì¸ '+i1.toLocaleString()+' + ë°°ìš°ì '+i2.toLocaleString();
  document.getElementById('equityLabel').textContent='íˆ¬ì… ê°€ëŠ¥ ìê¸°ìê¸ˆ';document.getElementById('equity').textContent=fmtShort(eq);document.getElementById('equitySub').textContent='ì´ '+cash.toLocaleString()+' - ì¸í…Œë¦¬ì–´ '+interior.toLocaleString();
  document.getElementById('mainPriceLabel').textContent='ìµœëŒ€ ë§¤ìˆ˜ ê°€ëŠ¥ê°€';document.getElementById('maxPrice').textContent=fmtShort(mpp);document.getElementById('maxPrice').style.color=mpp>=30000?'var(--green)':mpp>=20000?'var(--yellow)':'var(--red)';
  document.getElementById('maxPriceSub').textContent='ìê¸°ìê¸ˆ '+fmtShort(eq)+' + ëŒ€ì¶œ '+fmtShort(fL);document.getElementById('maxPriceBar').style.width=Math.min(100,mpp/600*100)+'%';
  document.getElementById('monthlyLabel').textContent='ì›” ìƒí™˜ ì—¬ë ¥';document.getElementById('monthlyLeft').textContent=mr+'ë§Œ';document.getElementById('monthlyLeft').style.color=mr>=150?'var(--green)':mr>=100?'var(--yellow)':'var(--red)';
  document.getElementById('monthlyLeftSub').textContent='í•œë„ '+ml+'ë§Œ - ê´€ë¦¬ë¹„ '+mg+'ë§Œ';document.getElementById('monthlyBar').style.width=Math.min(100,mr/250*100)+'%';document.getElementById('monthlyBar').style.background='var(--green)';
  document.getElementById('ltvMax').textContent=fmtShort(ltvL);document.getElementById('ltvDetail').innerHTML='LTV '+eLTV+'%<br><span>ìê¸°ìê¸ˆ '+fmtShort(eq)+' â†’ ë§¤ë§¤ê°€ '+fmtShort(Math.floor(eq/(1-eLTV/100)))+'ê¹Œì§€</span>';document.getElementById('ltvCard').className='loan-card '+(ltvL>=fL?'ok':'warn');
  document.getElementById('dsrMax').textContent=fmtShort(dsrL);document.getElementById('dsrDetail').innerHTML='DSR '+dp+'% Â· ì—°ì†Œë“ '+fmtShort(ti)+'<br><span>ì›” '+Math.floor(mrd)+'ë§Œ ìƒí™˜ ê°€ëŠ¥</span>';document.getElementById('dsrCard').className='loan-card '+(dsrL>=fL?'ok':'warn');
  document.getElementById('monthlyMax').textContent=fmtShort(mlL);document.getElementById('monthlyDetail').innerHTML='ì›” '+mr+'ë§Œ ìƒí™˜ ê°€ëŠ¥<br><span>ê¸ˆë¦¬ '+rate+'% Â· '+term+'ë…„</span>';document.getElementById('monthlyCard').className='loan-card '+(mlL>=fL?'ok':'warn');
  document.getElementById('finalLoan').textContent=fmtShort(fL);document.getElementById('finalDetail').innerHTML='ì›” '+fM+'ë§Œ Â· ë§¤ìˆ˜ê°€ëŠ¥ '+fmtShort(mpp)+'<br><span>LTVÂ·DSRÂ·ì›”ìƒí™˜ ì¤‘ ìµœì†Ÿê°’</span>';
  let bn='LTV';if(fL===dsrL)bn='DSR';if(fL===mlL)bn='ì›”ìƒí™˜';document.getElementById('loanBadge').textContent='ë³‘ëª©: '+bn;
  updatePropTable(eq,fL,eLTV,rate,term,mr);
}
function updatePropTable(eq,fL,eLTV,rate,term,mr){
  searchQuery=document.getElementById('searchInput').value.toLowerCase();regionFilterVal=document.getElementById('regionFilter').value;
  let f=PROPERTIES.filter(p=>{if(searchQuery&&!(p.name+' '+p.region+' '+p.dong).toLowerCase().includes(searchQuery))return false;if(regionFilterVal&&p.region!==regionFilterVal)return false;return true;});
  if(currentSort==='price-asc')f.sort((a,b)=>a.price-b.price);else if(currentSort==='price-desc')f.sort((a,b)=>b.price-a.price);else if(currentSort==='walk')f.sort((a,b)=>(a.walk_min||999)-(b.walk_min||999));
  const wv=f.map(p=>{const pL=p.regulated?Math.min(eLTV,50):eLTV,pLn=Math.min(Math.floor(p.price*pL/100),fL),pEq=p.price-pLn,pM=Math.floor(monthlyPayment(pLn,rate,term));let v,vt;if(pEq>eq){v='ìê¸ˆë¶€ì¡±';vt='tag-danger';}else if(pM>mr){v='ìƒí™˜ì´ˆê³¼';vt='tag-danger';}else if(pM>mr*0.85){v='ë¹ ë“¯í•¨';vt='tag-warn';}else{v='ë§¤ìˆ˜ê°€ëŠ¥';vt='tag-ok';}return{...p,pLTV:pL,pLoan:pLn,pEquityNeeded:pEq,pMonthly:pM,verdict:v,verdictTag:vt};}).filter(p=>!verdictFilterVal||p.verdict===verdictFilterVal);
  const ti=wv.length,tp=Math.max(1,Math.ceil(ti/pageSize));if(currentPage>tp)currentPage=tp;const si=(currentPage-1)*pageSize,pi=wv.slice(si,si+pageSize);
  const tb=document.getElementById('propertyBody');tb.innerHTML='';
  pi.forEach(p=>{const ex=[];if(p.built_year)ex.push(p.built_year+'ë…„');if(p.households)ex.push(p.households+'ì„¸ëŒ€');if(p.trade_count>1)ex.push(p.trade_count+'ê±´');
    const tBtn=p.trade_count>1?'<button class="expand-btn" onclick="toggleHistory(this)">â–¶ ê±°ë˜ë‚´ì—­ '+p.trade_count+'ê±´</button>':'';
    let hH='';if(p.trade_count>1){const rows=p.trades.map((t,i)=>{let d='';if(i<p.trades.length-1){const df=t.price-p.trades[i+1].price;d=df>0?'<span class="trade-delta up">+'+fmtShort(df)+'</span>':df<0?'<span class="trade-delta down">'+fmtShort(df)+'</span>':'<span class="trade-delta same">Â±0</span>';}return '<div class="trade-row"><span class="trade-date">'+(t.date||'ë‚ ì§œì—†ìŒ')+'</span><span class="trade-price">'+fmtShort(t.price)+'</span><span class="trade-floor">'+t.floor+'ì¸µ</span>'+d+'</div>';}).join('');const pd=p.max_price-p.min_price;hH='<div class="trade-history"><div class="trade-history-title"><span>ğŸ“Š ê±°ë˜ íˆìŠ¤í† ë¦¬</span><span style="font-size:10px;color:var(--text-dim)">'+(pd>0?'ë³€ë™í­: '+fmtShort(pd):'ë™ì¼ê°€')+'</span></div>'+rows+'</div>';}
    const tr=document.createElement('tr');tr.innerHTML='<td data-label="ë‹¨ì§€ëª…"><strong>'+p.name+'</strong><br><span style="font-size:10px;color:var(--text-dim)">'+(p.line?p.line+' ':'')+p.station+(ex.length?' Â· '+ex.join(' Â· '):'')+'</span><br>'+tBtn+hH+'</td><td data-label="ì§€ì—­"><span class="tag tag-region">'+p.region+'</span></td><td data-label="ë©´ì ">'+fmtArea(p)+'</td><td data-label="ë§¤ë§¤ê°€" class="mono">'+fmtShort(p.price)+(p.trade_count>1?'<br><span style="font-size:9px;color:var(--text-dim)">'+fmtShort(p.min_price)+'~'+fmtShort(p.max_price)+'</span>':'')+'</td><td data-label="í•„ìš”ìê¸ˆ" class="mono" style="color:'+(p.pEquityNeeded>eq?'var(--red)':'var(--text)')+'">'+fmtShort(p.pEquityNeeded)+'</td><td data-label="ëŒ€ì¶œì•¡" class="mono">'+fmtShort(p.pLoan)+'<br><span style="font-size:10px;color:var(--text-dim)">LTV '+p.pLTV+'%</span></td><td data-label="ì›”ìƒí™˜" class="mono" style="color:'+(p.pMonthly>mr?'var(--red)':p.pMonthly>mr*0.85?'var(--yellow)':'var(--green)')+'">'+p.pMonthly+'ë§Œ</td><td data-label="íŒì •"><span class="tag '+p.verdictTag+'">'+p.verdict+'</span></td><td data-label="ë§í¬"><div class="link-icons">'+makeLinks(p)+'</div></td>';
    tb.appendChild(tr);
  });
  document.getElementById('propertyBadge').textContent=DATA_LOADED?ti+'/'+PROPERTIES.length+'ê°œ í‘œì‹œ':'ë°ì´í„° ì—†ìŒ';
  document.getElementById('pageInfo').textContent=ti>0?(si+1)+'-'+Math.min(si+pageSize,ti)+' / '+ti+'ê±´':'0ê±´';
  const pb=document.getElementById('pageBtns');pb.innerHTML='';
  if(tp>1){const pv=document.createElement('button');pv.className='page-btn';pv.textContent='â—€';pv.disabled=currentPage<=1;pv.onclick=()=>{currentPage--;update();};pb.appendChild(pv);for(let i=1;i<=tp;i++){if(tp>7&&i>2&&i<tp-1&&Math.abs(i-currentPage)>1){if(i===3||i===tp-2){const d=document.createElement('span');d.className='page-info';d.textContent='â€¦';pb.appendChild(d);}continue;}const b=document.createElement('button');b.className='page-btn'+(i===currentPage?' active':'');b.textContent=i;b.onclick=()=>{currentPage=i;update();};pb.appendChild(b);}const nx=document.createElement('button');nx.className='page-btn';nx.textContent='â–¶';nx.disabled=currentPage>=tp;nx.onclick=()=>{currentPage++;update();};pb.appendChild(nx);}
}
function updateRent(){
  const i1=getVal('income1'),i2=getVal('income2'),ti=i1+i2,cash=getVal('cash'),eq=cash;
  const rr=getVal('rentRate'),rlr=getVal('rentLoanRatio'),rll=getVal('rentLoanLimit');
  const rf=rlr/100;let mbr=rf<1?eq/(1-rf):eq+rll;let lfr=Math.floor(mbr*rf);const aL=Math.min(lfr,rll),rb=eq+aL,mi=Math.round(aL*rr/100/12);
  document.getElementById('totalIncome').textContent=fmtShort(ti);document.getElementById('totalIncomeSub').textContent='ë³¸ì¸ '+i1.toLocaleString()+' + ë°°ìš°ì '+i2.toLocaleString();
  document.getElementById('equityLabel').textContent='ìê¸°ìê¸ˆ (ì „ì„¸ë³´ì¦ê¸ˆìš©)';document.getElementById('equity').textContent=fmtShort(eq);document.getElementById('equitySub').textContent='ì´ ê°€ìš© ìê¸ˆ ì „ì•¡ íˆ¬ì…';
  document.getElementById('mainPriceLabel').textContent='ìµœëŒ€ ì „ì„¸ ì˜ˆì‚°';document.getElementById('maxPrice').textContent=fmtShort(rb);document.getElementById('maxPrice').style.color=rb>=35000?'var(--green)':rb>=25000?'var(--yellow)':'var(--mode-accent)';
  document.getElementById('maxPriceSub').textContent='ìê¸°ìê¸ˆ '+fmtShort(eq)+' + ëŒ€ì¶œ '+fmtShort(aL);document.getElementById('maxPriceBar').style.width=Math.min(100,rb/500*100)+'%';
  document.getElementById('monthlyLabel').textContent='ì›” ì´ì ë¶€ë‹´';document.getElementById('monthlyLeft').textContent=mi+'ë§Œ';document.getElementById('monthlyLeft').style.color=mi<=50?'var(--green)':mi<=80?'var(--yellow)':'var(--red)';
  document.getElementById('monthlyLeftSub').textContent='ëŒ€ì¶œ '+fmtShort(aL)+' Ã— '+rr+'%';document.getElementById('monthlyBar').style.width=Math.min(100,mi/150*100)+'%';document.getElementById('monthlyBar').style.background=mi<=50?'var(--green)':mi<=80?'var(--yellow)':'var(--red)';
  const tn=document.getElementById('rentLoanType').value==='policy'?'ì •ì±…ëŒ€ì¶œ':'ì‹œì¤‘ì€í–‰';
  document.getElementById('rentLimitMax').textContent=fmtShort(aL);document.getElementById('rentLimitDetail').innerHTML=tn+' Â· ë³´ì¦ê¸ˆì˜ '+rlr+'%<br><span>ìƒí•œ: '+fmtShort(rll)+'</span>';document.getElementById('rentLimitCard').className='loan-card '+(aL>=rll?'warn':'ok');
  document.getElementById('rentInterest').textContent=mi+'ë§Œ';document.getElementById('rentInterestDetail').innerHTML='ì—° '+rr+'% Â· ì´ìë§Œ ë‚©ë¶€<br><span>DSR ë¯¸ì ìš© (ì „ì„¸ëŒ€ì¶œ)</span>';document.getElementById('rentInterestCard').className='loan-card '+(mi<=50?'ok':mi<=80?'warn':'danger');
  document.getElementById('rentBudget').textContent=fmtShort(rb);document.getElementById('rentBudgetDetail').innerHTML='ìê¸°ìê¸ˆ '+fmtShort(eq)+' + ëŒ€ì¶œ '+fmtShort(aL)+'<br><span>ì´ ê¸ˆì•¡ ì´í•˜ ì „ì„¸ íƒìƒ‰</span>';document.getElementById('rentBudgetCard').className='loan-card ok';
  document.getElementById('rentLoanBadge').textContent=tn+' Â· '+rr+'%';
  updateRentTable(eq,rb);
}
function updateRentTable(equity,budget){
  const placeholder=document.getElementById('rentPlaceholder');
  const tableWrap=document.getElementById('rentTableWrap');
  if(!RENT_DATA_LOADED||RENT_PROPERTIES.length===0){if(placeholder)placeholder.style.display='';if(tableWrap)tableWrap.style.display='none';return;}
  if(placeholder)placeholder.style.display='none';if(tableWrap)tableWrap.style.display='';
  const tabBtnProp=document.getElementById('tabBtnProperties');tabBtnProp.style.display='';tabBtnProp.textContent='ğŸ“Š ì „ì„¸ ì‹¤ê±°ë˜';
  const sq=(document.getElementById('rentSearchInput')||{}).value||'';const rf=(document.getElementById('rentRegionFilter')||{}).value||'';
  let f=RENT_PROPERTIES.filter(p=>{if(sq&&!(p.name+' '+p.region+' '+p.dong).toLowerCase().includes(sq.toLowerCase()))return false;if(rf&&p.region!==rf)return false;if(rentTypeFilterVal&&p.rent_type!==rentTypeFilterVal)return false;return true;});
  if(rentSort==='price-asc')f.sort((a,b)=>a.deposit-b.deposit);else if(rentSort==='price-desc')f.sort((a,b)=>b.deposit-a.deposit);else if(rentSort==='walk')f.sort((a,b)=>(a.walk_min||999)-(b.walk_min||999));
  const wv=f.map(p=>{let v,vt;if(p.deposit>budget){v='ì˜ˆì‚°ì´ˆê³¼';vt='tag-danger';}else if(p.deposit>budget*0.9){v='ë¹ ë“¯í•¨';vt='tag-warn';}else{v='ê°€ëŠ¥';vt='tag-ok';}return{...p,verdict:v,verdictTag:vt};});
  const filtered=rentVerdictFilterVal?wv.filter(p=>p.verdict===rentVerdictFilterVal):wv;
  const ti=filtered.length,tp=Math.max(1,Math.ceil(ti/pageSize));if(rentPage>tp)rentPage=tp;const si=(rentPage-1)*pageSize,pi=filtered.slice(si,si+pageSize);
  const tb=document.getElementById('rentPropertyBody');if(!tb)return;tb.innerHTML='';
  pi.forEach(p=>{const ex=[];if(p.built_year)ex.push(p.built_year+'ë…„');if(p.households)ex.push(p.households+'ì„¸ëŒ€');if(p.trade_count>1)ex.push(p.trade_count+'ê±´');
    const typeTag=p.rent_type==='ì›”ì„¸'?'<span class="tag tag-warn" style="font-size:10px">ì›”ì„¸</span>':'<span class="tag tag-ok" style="font-size:10px">ì „ì„¸</span>';
    const tBtn=p.trade_count>1?'<button class="expand-btn" onclick="toggleHistory(this)">â–¶ ê±°ë˜ë‚´ì—­ '+p.trade_count+'ê±´</button>':'';
    let hH='';if(p.trade_count>1){const rows=p.trades.map((t,i)=>{let d='';if(i<p.trades.length-1){const df=t.deposit-p.trades[i+1].deposit;d=df>0?'<span class="trade-delta up">+'+fmtShort(df)+'</span>':df<0?'<span class="trade-delta down">'+fmtShort(df)+'</span>':'<span class="trade-delta same">Â±0</span>';}return '<div class="trade-row"><span class="trade-date">'+(t.date||'ë‚ ì§œì—†ìŒ')+'</span><span class="trade-price">'+fmtShort(t.deposit)+'</span><span class="trade-floor">'+t.floor+'ì¸µ</span>'+d+'</div>';}).join('');const pd=p.max_deposit-p.min_deposit;hH='<div class="trade-history"><div class="trade-history-title"><span>ğŸ“Š ê±°ë˜ íˆìŠ¤í† ë¦¬</span><span style="font-size:10px;color:var(--text-dim)">'+(pd>0?'ë³€ë™í­: '+fmtShort(pd):'ë™ì¼ê°€')+'</span></div>'+rows+'</div>';}
    const tr=document.createElement('tr');tr.innerHTML='<td data-label="ë‹¨ì§€ëª…"><strong>'+p.name+'</strong><br><span style="font-size:10px;color:var(--text-dim)">'+(p.line?p.line+' ':'')+p.station+(ex.length?' Â· '+ex.join(' Â· '):'')+'</span><br>'+tBtn+hH+'</td><td data-label="ì§€ì—­"><span class="tag tag-region">'+p.region+'</span></td><td data-label="ë©´ì ">'+fmtArea(p)+'</td><td data-label="ìœ í˜•">'+typeTag+'</td><td data-label="ë³´ì¦ê¸ˆ" class="mono">'+fmtShort(p.deposit)+(p.trade_count>1?'<br><span style="font-size:9px;color:var(--text-dim)">'+fmtShort(p.min_deposit)+'~'+fmtShort(p.max_deposit)+'</span>':'')+'</td><td data-label="ì›”ì„¸" class="mono">'+(p.monthly_rent>0?p.monthly_rent+'ë§Œ':'â€”')+'</td><td data-label="íŒì •"><span class="tag '+p.verdictTag+'">'+p.verdict+'</span></td><td data-label="ë§í¬"><div class="link-icons">'+makeLinks(p)+'</div></td>';
    tb.appendChild(tr);
  });
  document.getElementById('rentPropertyBadge').textContent=ti+'/'+RENT_PROPERTIES.length+'ê°œ í‘œì‹œ';
  document.getElementById('rentPageInfo').textContent=ti>0?(si+1)+'-'+Math.min(si+pageSize,ti)+' / '+ti+'ê±´':'0ê±´';
  const pb=document.getElementById('rentPageBtns');pb.innerHTML='';
  if(tp>1){const pv=document.createElement('button');pv.className='page-btn';pv.textContent='â—€';pv.disabled=rentPage<=1;pv.onclick=()=>{rentPage--;update();};pb.appendChild(pv);for(let i=1;i<=tp;i++){if(tp>7&&i>2&&i<tp-1&&Math.abs(i-rentPage)>1){if(i===3||i===tp-2){const d=document.createElement('span');d.className='page-info';d.textContent='â€¦';pb.appendChild(d);}continue;}const b=document.createElement('button');b.className='page-btn'+(i===rentPage?' active':'');b.textContent=i;b.onclick=()=>{rentPage=i;update();};pb.appendChild(b);}const nx=document.createElement('button');nx.className='page-btn';nx.textContent='â–¶';nx.disabled=rentPage>=tp;nx.onclick=()=>{rentPage++;update();};pb.appendChild(nx);}
}
function updatePolicyTimeline(){
  const tl=document.getElementById('policyTimeline');
  const policies=[
    {date:'2025.10.15',level:'high',title:'10.15 ì£¼íƒì‹œì¥ ì•ˆì •í™” ëŒ€ì±…',impact:'ì„œìš¸ ì „ì—­ + ê²½ê¸° 12ê³³ ê·œì œì§€ì—­ ì§€ì •',detail:'â†’ ì„±ë‚¨Â·ì•ˆì–‘ LTV 40~50%, ìš©ì¸ ìˆ˜ì§€Â·ê²½ê¸° ê´‘ì£¼ëŠ” ë¹„ê·œì œ ìœ ì§€ (70%)',myImpactType:'negative',myImpactBuy:'ì„±ë‚¨Â·ì•ˆì–‘ ë§¤ìˆ˜ ì‹œ LTV 40~50% â†’ ìê¸°ìê¸ˆ ë¹„ì¤‘ ì¦ê°€. ë¹„ê·œì œ(ìš©ì¸ ìˆ˜ì§€Â·ê´‘ì£¼) ë§¤ìˆ˜ê°€ ìœ ë¦¬',myImpactRent:'ì „ì„¸ëŒ€ì¶œì—ëŠ” ì§ì ‘ ì˜í–¥ ì—†ìŒ. ë‹¤ë§Œ ê·œì œì§€ì—­ ì „ì„¸ê°€ ì•ˆì •í™” ê°€ëŠ¥ì„±'},
    {date:'2025.07',level:'high',title:'ì‹ í˜¼ë¶€ë¶€ ë²„íŒ€ëª© ì†Œë“ ê¸°ì¤€ 1ì–µ ì™„í™”ì•ˆ ë¬´ì‚°',impact:'ê°€ê³„ë¶€ì±„ ê´€ë¦¬ ê°•í™” ê¸°ì¡°ë¡œ ì‹œí–‰ ì·¨ì†Œ',detail:'â†’ 7,500ë§Œì› ê¸°ì¤€ ìœ ì§€, ë¶€ë¶€í•©ì‚° 8,740ë§Œì› ì´ˆê³¼ë¡œ ìê²© ë¶ˆê°€',myImpactType:'negative',myImpactBuy:'í•´ë‹¹ ì—†ìŒ (ë§¤ìˆ˜ìš© ì•„ë‹Œ ì „ì„¸ ì •ì±…)',myImpactRent:'í•©ì‚° 8,740ë§Œ > 7,500ë§Œ â†’ ì‹ í˜¼ë¶€ë¶€ ë²„íŒ€ëª© ì „ì„¸ëŒ€ì¶œ ì´ìš© ë¶ˆê°€ ìœ ì§€'},
    {date:'2025.06.27',level:'high',title:'6.27 ê°€ê³„ë¶€ì±„ ê´€ë¦¬ ê°•í™”',impact:'ìˆ˜ë„ê¶Œ ì£¼ë‹´ëŒ€ í•œë„ 6ì–µ ì œí•œ, ìƒì• ìµœì´ˆ LTV 80%â†’70%',detail:'â†’ ìê¸°ìê¸ˆ ë¹„ì¤‘ ìƒìŠ¹, ë§¤ìˆ˜ê°€ëŠ¥ ê°€ê²©ëŒ€ í•˜í–¥ ì••ë°•',myImpactType:'negative',myImpactBuy:'ì£¼ë‹´ëŒ€ í•œë„ 6ì–µ ì œí•œì€ ìš°ë¦¬ ê°€ê²©ëŒ€(~5ì–µ)ì—ëŠ” ì˜í–¥ ì ìŒ. ìƒì• ìµœì´ˆ LTV í•˜ë½ì€ ë¶ˆë¦¬',myImpactRent:'ì „ì„¸ëŒ€ì¶œì—ëŠ” ì§ì ‘ ì˜í–¥ ì—†ìŒ'},
    {date:'2025.11',level:'mid',title:'ê¸°ì¤€ê¸ˆë¦¬ ì¸í•˜ 3.0% â†’ 2.75%',impact:'',detail:'â†’ ì›” ìƒí™˜ ë¶€ë‹´ ì†Œí­ ê²½ê°, 3.5ì–µ ê¸°ì¤€ ì›” ~8ë§Œì› ì ˆê°',myImpactType:'positive',myImpactBuy:'ì£¼ë‹´ëŒ€ ê¸ˆë¦¬ í•˜ë½ â†’ ì›” ìƒí™˜ ë¶€ë‹´ ì†Œí­ ê²½ê°',myImpactRent:'ì „ì„¸ëŒ€ì¶œ ê¸ˆë¦¬ë„ ì—°ë™ í•˜ë½ ê°€ëŠ¥ â†’ ì›” ì´ì ë¶€ë‹´ ê°ì†Œ'},
    {date:'2025.01',level:'mid',title:'ì‹ ìƒì•„ íŠ¹ë¡€ëŒ€ì¶œ í•œë„ ìƒí–¥',impact:'êµ¬ì…ëŒ€ì¶œ í•œë„ 1.3ì–µâ†’2.5ì–µ, ì „ì„¸ í•œë„ ë³€ê²½ ì—†ìŒ',detail:'â†’ 2025ë…„ ì´í›„ ì¶œì‚° ê°€êµ¬, ì†Œë“ 2ì–µ ì´í•˜ ë§ë²Œì´ ê°€ëŠ¥',myImpactType:'positive',myImpactBuy:'ì¶œì‚° ì‹œ í•©ì‚° 8,740ë§Œ < 2ì–µ â†’ ìê²© ì¶©ì¡±. í•œë„ ìµœëŒ€ 2.5ì–µìœ¼ë¡œ ëŒ€í­ ìƒí–¥',myImpactRent:'ì¶œì‚° ì‹œ ì „ì„¸ íŠ¹ë¡€ë„ í™œìš© ê°€ëŠ¥ (ì†Œë“ 1.3ì–µ ì´í•˜, ë§ë²Œì´ 2ì–µ)'}
  ];
  tl.innerHTML='';
  policies.forEach(p=>{const myImpact=currentMode==='buy'?p.myImpactBuy:p.myImpactRent;const item=document.createElement('div');item.className='tl-item';item.innerHTML='<div class="tl-dot '+p.level+'"></div><div class="tl-date">'+p.date+'</div><div class="tl-body"><div class="tl-title">'+p.title+'</div><div class="tl-impact">'+(p.impact?p.impact+'<br>':'')+'<em>'+p.detail+'</em></div><div class="tl-my-impact '+p.myImpactType+'"><div class="impact-label">'+(p.myImpactType==='positive'?'âœ…':p.myImpactType==='negative'?'âš ï¸':'â„¹ï¸')+' ìš°ë¦¬ ìƒí™© ì˜í–¥</div><div>'+myImpact+'</div></div></div>';tl.appendChild(item);});
}
function updatePolicy(){
  const i1=getVal('income1'),i2=getVal('income2'),ti=i1+i2,mi=Math.min(i1,i2),hc=parseInt(document.getElementById('houseCount').value);
  const assessedIncome=isMarried?ti:mi;const pg=document.getElementById('policyGrid');pg.innerHTML='';let ec=0;
  const loans=currentMode==='buy'?[
    {name:'ë””ë”¤ëŒ ëŒ€ì¶œ',icon:'ğŸ ',incomeLimit:6000,desc:'ë¶€ë¶€í•©ì‚° 6,000ë§Œ ì´í•˜',maxLoan:'ìµœëŒ€ 2ì–µ',rate:'2.85~4.15%',conditions:['ë¬´ì£¼íƒ','ì£¼íƒ 5ì–µ ì´í•˜','LTV 70%'],houseReq:0,note:'ìƒì• ìµœì´ˆ: ì†Œë“ 7,000ë§ŒÂ·í•œë„ 2.4ì–µÂ·LTV 80%'},
    {name:'ë³´ê¸ˆìë¦¬ë¡ ',icon:'ğŸ›¡ï¸',incomeLimit:7000,desc:'ë¶€ë¶€í•©ì‚° 7,000ë§Œ ì´í•˜',maxLoan:'ìµœëŒ€ 3.6ì–µ',rate:'4.05~4.35%',conditions:['ë¬´ì£¼íƒ/1ì£¼íƒ ì²˜ë¶„','ì£¼íƒ 6ì–µ ì´í•˜','LTV 70%'],houseReq:1,note:'ìƒì• ìµœì´ˆ: í•œë„ 4.2ì–µÂ·LTV 80%'},
    {name:'ì‹ í˜¼ë¶€ë¶€ êµ¬ì…',icon:'ğŸ’',incomeLimit:8500,desc:'ë¶€ë¶€í•©ì‚° 8,500ë§Œ ì´í•˜',maxLoan:'ìµœëŒ€ 3.2ì–µ',rate:'1.85~3.65%',conditions:['í˜¼ì¸ 7ë…„ ì´ë‚´','ë¬´ì£¼íƒ','6ì–µ ì´í•˜','LTV 80%'],houseReq:0,note:'í˜¼ì¸ì‹ ê³  í•„ìˆ˜'},
    {name:'ì‹ ìƒì•„ íŠ¹ë¡€',icon:'ğŸ‘¶',incomeLimit:13000,incomeLimitDual:20000,desc:'1.3ì–µ ì´í•˜ (ë§ë²Œì´ 2ì–µ)',maxLoan:'ìµœëŒ€ 2.5ì–µ',rate:'1.80~4.50%',conditions:['2ë…„ ë‚´ ì¶œì‚°','ë¬´ì£¼íƒ','9ì–µ ì´í•˜'],houseReq:0,special:'ì¶œì‚° ì‹œ í™œìš© ê°€ëŠ¥',note:'2025ë…„ ì´í›„ ì¶œì‚°, í•œë„ 1.3ì–µâ†’2.5ì–µ ìƒí–¥'}
  ]:[
    {name:'ì²­ë…„ ë²„íŒ€ëª©',icon:'ğŸ§‘â€ğŸ’¼',incomeLimit:5000,singleOnly:true,desc:'ë‹¨ë… 5,000ë§Œ ì´í•˜',maxLoan:'ìµœëŒ€ 2ì–µ (80%)',rate:'2.2~3.3%',conditions:['ë§Œ 19~34ì„¸','ë¬´ì£¼íƒ','ë³´ì¦ê¸ˆ 3ì–µ ì´í•˜'],houseReq:0,note:'ì†Œë“ 2ì²œë§Œ ì´í•˜ ì‹œ ê¸ˆë¦¬ 2.2%'},
    {name:'ì¼ë°˜ ë²„íŒ€ëª©',icon:'ğŸ ',incomeLimit:5000,desc:(isMarried?'ë¶€ë¶€í•©ì‚°':'ë‹¨ë…')+' 5,000ë§Œ ì´í•˜',maxLoan:'ìµœëŒ€ 1.2ì–µ (70%)',rate:'2.5~3.5%',conditions:['ë¬´ì£¼íƒ','ë³´ì¦ê¸ˆ 3ì–µ ì´í•˜'],houseReq:0},
    {name:'ì‹ í˜¼ë¶€ë¶€ ë²„íŒ€ëª©',icon:'ğŸ’',incomeLimit:7500,marriedOnly:true,desc:'ë¶€ë¶€í•©ì‚° 7,500ë§Œ ì´í•˜',maxLoan:'ìµœëŒ€ 2.5ì–µ (80%)',rate:'1.9~3.3%',conditions:['í˜¼ì¸ 7ë…„ ì´ë‚´','ë¬´ì£¼íƒ'],houseReq:0,note:'ì†Œë“ 1ì–µ ì™„í™”ì•ˆ ë¬´ì‚° (2025.7)'},
    {name:'ì‹ ìƒì•„ íŠ¹ë¡€ ì „ì„¸',icon:'ğŸ‘¶',incomeLimit:13000,incomeLimitDual:20000,desc:'1.3ì–µ ì´í•˜ (ë§ë²Œì´ 2ì–µ)',maxLoan:'ìµœëŒ€ 2.4ì–µ (80%)',rate:'1.6~3.1%',conditions:['2ë…„ ë‚´ ì¶œì‚°','ë¬´ì£¼íƒ'],houseReq:0,special:'ì¶œì‚° ì‹œ í™œìš© ê°€ëŠ¥'},
    {name:'ì¤‘ê¸°ì²­ ì „ì„¸',icon:'ğŸ¢',incomeLimit:5000,singleOnly:true,desc:'ë‹¨ë… 5,000ë§Œ ì´í•˜',maxLoan:'ìµœëŒ€ 1ì–µ (100%)',rate:'1.5% ê³ ì •',conditions:['ì¤‘ì†Œê¸°ì—… ì¬ì§','ë¬´ì£¼íƒ','ë§Œ 19~34ì„¸'],houseReq:0,note:'ë³´ì¦ê¸ˆ ì „ì•¡ ëŒ€ì¶œ ê°€ëŠ¥'},
    {name:'ì²­ë…„ ì›”ì„¸',icon:'ğŸ’³',incomeLimit:5000,singleOnly:true,desc:'ë‹¨ë… 5,000ë§Œ ì´í•˜',maxLoan:'ë³´ì¦ê¸ˆ 4,500ë§Œ',rate:'1.3%',conditions:['ë§Œ 19~34ì„¸','ë¬´ì£¼íƒ'],houseReq:0,note:'ì›”ì„¸ ì§€ì› ëª©ì , ë³´ì¦ê¸ˆ ì†Œì•¡'}
  ];
  loans.forEach(loan=>{
    const eil=loan.incomeLimitDual||loan.incomeLimit;let effectiveIncome;if(loan.singleOnly){effectiveIncome=isMarried?ti:mi;}else if(loan.marriedOnly){effectiveIncome=ti;}else{effectiveIncome=isMarried?ti:mi;}
    const gap=effectiveIncome-eil,iOk=gap<=0,hOk=hc<=(loan.houseReq||0),isSp=!!loan.special,needsMarriage=!!loan.marriedOnly;
    let sc,st,cc;if(needsMarriage&&!isMarried){sc='no';st='âŒ í˜¼ì¸ì‹ ê³  í•„ìš”';cc='ineligible';}else if(iOk&&hOk&&!isSp){sc='yes';st='âœ… ìê²© ì¶©ì¡±';cc='eligible';ec++;}else if(isSp){sc='check';st='â³ '+loan.special;cc='checking';}else if(iOk&&!hOk){sc='maybe';st='â³ ë¬´ì£¼íƒ ì‹œ ê°€ëŠ¥';cc='conditional';}else if(!iOk&&gap<=1000){sc='maybe';st='âš ï¸ ì†Œë“ ê·¼ì ‘';cc='conditional';}else{sc='no';st='âŒ ì†Œë“ ì´ˆê³¼';cc='ineligible';}
    let gt,gc;if(gap>0){gt=gap.toLocaleString()+'ë§Œ ì´ˆê³¼';gc=gap<=1000?'close':'over';}else if(gap===0){gt='ê¸°ì¤€ ë”± ë§ìŒ';gc='close';}else{gt=Math.abs(gap).toLocaleString()+'ë§Œ ì—¬ìœ ';gc='under';}
    const nH=loan.note?'<div style="font-size:10px;color:var(--accent2);margin-top:4px">ğŸ’¡ '+loan.note+'</div>':'';
    let whatIfH='';if(isMarried&&!iOk&&!isSp){const altGap=mi-eil;if(altGap<=0)whatIfH='<div class="policy-what-if">ğŸ’­ ë¯¸í˜¼ ì‹œ ë‹¨ë…('+fmtShort(mi)+') â†’ ìê²© ì¶©ì¡± ê°€ëŠ¥í–ˆìŒ (ì°¸ê³ ìš©)</div>';}else if(!isMarried&&iOk&&loan.singleOnly){const altGap=ti-eil;if(altGap>0)whatIfH='<div class="policy-what-if">âš ï¸ í˜¼ì¸ì‹ ê³  ì‹œ í•©ì‚°('+fmtShort(ti)+') â†’ ì†Œë“ '+altGap.toLocaleString()+'ë§Œ ì´ˆê³¼ë¡œ íƒˆë½</div>';}
    const incLabel=isMarried?'í•©ì‚° '+fmtShort(effectiveIncome):'ë‹¨ë… '+fmtShort(effectiveIncome);
    const c=document.createElement('div');c.className='policy-card '+cc;c.innerHTML='<div class="policy-name">'+loan.icon+' '+loan.name+' <span class="policy-status '+sc+'">'+st+'</span></div><div class="policy-detail">'+loan.desc+' Â· '+loan.maxLoan+' Â· '+loan.rate+'<br>ì¡°ê±´: '+loan.conditions.join(' / ')+'<br>ì‹¬ì‚¬ì†Œë“: '+incLabel+'</div>'+nH+whatIfH+'<div class="policy-gap '+gc+'">ì†Œë“ '+gt+'</div>';pg.appendChild(c);
  });
  document.getElementById('policyBadge').textContent=ec>0?ec+'ê°œ ìê²© ì¶©ì¡±!':'ìë™ íŒì •';
  document.getElementById('policyDateLabel').textContent='ğŸ“… ê¸°ì¤€: 2026ë…„ 2ì›” Â· '+(isMarried?'í˜¼ì¸ì‹ ê³  ì™„ë£Œ (ë¶€ë¶€í•©ì‚°)':'ë¯¸í˜¼ (ë‹¨ë… ì†Œë“)')+' Â· ì¶œì²˜: ì£¼íƒë„ì‹œê¸°ê¸ˆÂ·í•œêµ­ì£¼íƒê¸ˆìœµê³µì‚¬ ê³µì‹œ';
}
const PAIRS=[['income1','income1Val'],['income2','income2Val'],['cash','cashVal'],['interior','interiorVal'],['rate','rateVal'],['term','termVal'],['monthlyLimit','monthlyLimitVal'],['mgmt','mgmtVal'],['ltv','ltvVal'],['dsr','dsrVal'],['rentRate','rentRateVal'],['rentLoanRatio','rentLoanRatioVal'],['rentLoanLimit','rentLoanLimitVal']];
PAIRS.forEach(([s,i])=>{const sl=document.getElementById(s),ip=document.getElementById(i);if(sl&&ip){sl.addEventListener('input',()=>{ip.value=sl.value;update();});ip.addEventListener('input',()=>{sl.value=ip.value;update();});}});
document.getElementById('houseCount').addEventListener('change',update);
document.getElementById('searchInput').addEventListener('input',()=>{currentPage=1;update();});
document.getElementById('regionFilter').addEventListener('change',()=>{currentPage=1;update();});
const rsi=document.getElementById('rentSearchInput');if(rsi)rsi.addEventListener('input',()=>{rentPage=1;update();});
const rrf=document.getElementById('rentRegionFilter');if(rrf)rrf.addEventListener('change',()=>{rentPage=1;update();});

// â”€â”€â”€ ì¹´ì¹´ì˜¤ë§µ â”€â”€â”€
let kakaoMap=null,mapMarkers=[],mapInfoWindow=null,mapFilterVal='',mapInitialized=false,geocodingDone=false;
const MARKER_COLORS={ok:'#34d399',warn:'#fbbf24',danger:'#f87171',station:'#60a5fa'};
const MAP_STATIONS=[
  {name:"ê°•ë‚¨",lat:37.4979,lon:127.0276},{name:"ì–‘ì¬",lat:37.4842,lon:127.0353},{name:"íŒêµ",lat:37.3948,lon:127.1112},
  {name:"ì •ì",lat:37.3669,lon:127.1085},{name:"ë¯¸ê¸ˆ",lat:37.3510,lon:127.1095},{name:"ë™ì²œ",lat:37.3383,lon:127.1085},
  {name:"ìˆ˜ì§€êµ¬ì²­",lat:37.3220,lon:127.0960},{name:"ì„±ë³µ",lat:37.3114,lon:127.0786},{name:"ìƒí˜„",lat:37.3005,lon:127.0653},
  {name:"ê´‘êµì¤‘ì•™",lat:37.2886,lon:127.0492},{name:"ëª¨ë€",lat:37.4321,lon:127.1293},{name:"ì•¼íƒ‘",lat:37.4112,lon:127.1272}
];
function setMapFilter(btn){document.querySelectorAll('#mapVerdictChips .filter-chip').forEach(b=>b.classList.remove('active'));btn.classList.add('active');mapFilterVal=btn.dataset.val;updateMapMarkers();}
function geocodeUnmatchedProps(){
  if(geocodingDone)return;
  geocodingDone=true;
  const allProps=[...PROPERTIES,...RENT_PROPERTIES];
  // ì¤‘ë³µ ì œê±°: dong+name ê¸°ì¤€
  const seen={};const toGeocode=[];
  allProps.forEach(p=>{
    if(p.lat&&p.lon)return;
    const k=p.dong+'_'+p.name;if(seen[k])return;seen[k]=p;
    toGeocode.push(p);
  });
  if(toGeocode.length===0)return;
  const ps=new kakao.maps.services.Places();
  let idx=0,found=0;
  function next(){
    if(idx>=toGeocode.length){
      if(found>0)updateMapMarkers();
      document.getElementById('mapBadge').textContent+=' (ì§€ì˜¤ì½”ë”© ì™„ë£Œ)';
      return;
    }
    const p=toGeocode[idx++];
    const query=p.dong+' '+p.name;
    ps.keywordSearch(query,function(data,status){
      if(status===kakao.maps.services.Status.OK&&data.length>0){
        const lat=parseFloat(data[0].y),lon=parseFloat(data[0].x);
        // ê°™ì€ dong+nameì„ ê³µìœ í•˜ëŠ” ëª¨ë“  ì†ì„±ì— ì¢Œí‘œ ì ìš©
        allProps.forEach(ap=>{if(ap.dong===p.dong&&ap.name===p.name&&!ap.lat){ap.lat=lat;ap.lon=lon;}});
        found++;
      }
      if(idx%30===0&&found>0){updateMapMarkers();found=0;}
      setTimeout(next,80);
    },{size:1});
  }
  next();
}
function initMapIfNeeded(){
  if(mapInitialized)return;
  if(typeof kakao==='undefined'||!kakao.maps){document.getElementById('mapBadge').textContent='ì¹´ì¹´ì˜¤ë§µ ë¡œë”© ì‹¤íŒ¨';return;}
  kakao.maps.load(()=>{
    const container=document.getElementById('mapContainer');
    kakaoMap=new kakao.maps.Map(container,{center:new kakao.maps.LatLng(37.38,127.08),level:8});
    kakao.maps.event.addListener(kakaoMap,'idle',()=>{});
    mapInfoWindow=new kakao.maps.InfoWindow({zIndex:1});
    // ì—­ ë§ˆì»¤
    MAP_STATIONS.forEach(st=>{
      const m=new kakao.maps.Marker({map:kakaoMap,position:new kakao.maps.LatLng(st.lat,st.lon),image:new kakao.maps.MarkerImage('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png',new kakao.maps.Size(24,35))});
      kakao.maps.event.addListener(m,'click',()=>{mapInfoWindow.setContent('<div style="padding:4px 8px;font-size:12px;white-space:nowrap">ğŸš‡ '+st.name+'ì—­</div>');mapInfoWindow.open(kakaoMap,m);});
    });
    mapInitialized=true;
    updateMapMarkers();
    geocodeUnmatchedProps();
  });
}
function getMarkerSVG(color){return 'data:image/svg+xml;charset=utf-8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="32"><path d="M12 0C5.4 0 0 5.4 0 12c0 9 12 20 12 20s12-11 12-20C24 5.4 18.6 0 12 0z" fill="'+color+'"/><circle cx="12" cy="11" r="5" fill="white" opacity="0.9"/></svg>');}
function updateMapMarkers(){
  if(!kakaoMap)return;
  mapMarkers.forEach(m=>m.setMap(null));mapMarkers=[];
  const props=currentMode==='buy'?PROPERTIES:RENT_PROPERTIES;
  if(!props||props.length===0){document.getElementById('mapBadge').textContent='ë§¤ë¬¼ ë°ì´í„° ì—†ìŒ';return;}
  // íŒì • ê³„ì‚°
  const eq=currentMode==='buy'?Math.max(0,getVal('cash')-getVal('interior')):getVal('cash');
  const rate=getVal('rate'),term=getVal('term'),mr=getVal('monthlyLimit')-getVal('mgmt'),lp=getVal('ltv');
  const rr=getVal('rentRate'),rll=getVal('rentLoanLimit'),rlr=getVal('rentLoanRatio');
  const rf2=rlr/100;let mbr2=rf2<1?eq/(1-rf2):eq+rll;const aL2=Math.min(Math.floor(mbr2*rf2),rll),budget2=eq+aL2;
  // ì¤‘ë³µ ì œê±° (ê°™ì€ ë‹¨ì§€ ì¢Œí‘œ)
  const seen={};let cnt=0;
  props.forEach(p=>{
    if(!p.lat||!p.lon)return;
    const k=p.name+'_'+p.region;if(seen[k])return;seen[k]=true;
    let verdict;
    if(currentMode==='buy'){
      const eLTV=p.regulated?Math.min(lp,50):lp;
      const dsrL=Math.floor(maxLoanFromMonthly((getVal('income1')+getVal('income2'))*getVal('dsr')/100/12,rate,term));
      const mlL=Math.floor(maxLoanFromMonthly(mr,rate,term));
      const ltvL=eLTV>0&&eLTV<100?Math.floor(eq/(1-eLTV/100)*eLTV/100):0;
      const fL=Math.min(dsrL,mlL,ltvL);
      const pLn=Math.min(Math.floor(p.price*eLTV/100),fL),pEq=p.price-pLn,pM=Math.floor(monthlyPayment(pLn,rate,term));
      if(pEq>eq)verdict='danger';else if(pM>mr)verdict='danger';else if(pM>mr*0.85)verdict='warn';else verdict='ok';
    }else{
      if(p.deposit>budget2)verdict='danger';else if(p.deposit>budget2*0.9)verdict='warn';else verdict='ok';
    }
    if(mapFilterVal&&verdict!==mapFilterVal)return;
    const color=MARKER_COLORS[verdict];
    const img=new kakao.maps.MarkerImage(getMarkerSVG(color),new kakao.maps.Size(24,32));
    const marker=new kakao.maps.Marker({map:kakaoMap,position:new kakao.maps.LatLng(p.lat,p.lon),image:img});
    const priceStr=currentMode==='buy'?fmtShort(p.price):fmtShort(p.deposit);
    const label=currentMode==='buy'?'ë§¤ë§¤ ':'ë³´ì¦ê¸ˆ ';
    kakao.maps.event.addListener(marker,'click',()=>{
      mapInfoWindow.setContent('<div style="padding:8px 12px;font-size:12px;line-height:1.5;max-width:220px"><strong>'+p.name+'</strong><br><span style="color:#666">'+p.region+' Â· '+p.area+'</span><br><span style="font-weight:700">'+label+priceStr+'</span>'+(p.station?' Â· '+p.station:'')+'</div>');
      mapInfoWindow.open(kakaoMap,marker);
    });
    mapMarkers.push(marker);cnt++;
  });
  document.getElementById('mapBadge').textContent=cnt+'ê°œ ë§¤ë¬¼ í‘œì‹œ';
}
loadSettings().then(()=>loadData());
</script>
</body>
</html>
