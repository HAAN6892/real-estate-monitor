<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🏠 부동산 대시보드</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=12e8b95a1df898f6b847892500770551&autoload=false&libraries=services"></script>
</head>
<body>
<div class="main" id="main">
  <div class="top-bar">
    <div class="top-bar-left"><div><div class="logo" id="logoText">🏠 우리 집 사기</div><div class="logo-sub" id="dataStatus">데이터 로딩 중...</div></div></div>
    <div class="top-bar-right">
      <div class="mode-toggle">
        <button class="mode-btn active" data-mode="buy" onclick="switchMode('buy')">🏠 매수</button>
        <button class="mode-btn" data-mode="rent" onclick="switchMode('rent')">🔑 전세</button>
      </div>
      <button class="settings-btn" onclick="toggleSettings()">⚙️ 설정</button>
    </div>
  </div>
  <div class="marriage-status-bar" id="marriageBar">
    <div style="font-size:12px;font-weight:600;color:var(--text-mid)">💍 혼인신고</div>
    <div class="marriage-toggle">
      <button class="marriage-btn active" data-married="1" onclick="setMarriage(true)">신고 완료</button>
      <button class="marriage-btn" data-married="0" onclick="setMarriage(false)">미신고</button>
    </div>
    <div class="marriage-info" id="marriageInfo">부부합산 소득 적용 → 정책대출 대부분 <strong>소득 초과</strong></div>
    <div class="marriage-income-badge married" id="marriageIncomeBadge">합산 8,740만</div>
  </div>
  <div class="stats-row" id="statsRow">
    <div class="stat-card"><div class="stat-label">합산 연소득</div><div class="stat-value" id="totalIncome">—</div><div class="stat-sub" id="totalIncomeSub">—</div></div>
    <div class="stat-card"><div class="stat-label" id="equityLabel">투입 가능 자기자금</div><div class="stat-value" id="equity">—</div><div class="stat-sub" id="equitySub">—</div></div>
    <div class="stat-card"><div class="stat-label" id="mainPriceLabel">최대 매수 가능가</div><div class="stat-value" id="maxPrice" style="color:var(--mode-accent)">—</div><div class="stat-sub" id="maxPriceSub">—</div><div class="stat-bar"><div class="stat-bar-fill" id="maxPriceBar" style="width:0%;background:var(--mode-accent)"></div></div></div>
    <div class="stat-card"><div class="stat-label" id="monthlyLabel">월 상환 여력</div><div class="stat-value" id="monthlyLeft">—</div><div class="stat-sub" id="monthlyLeftSub">—</div><div class="stat-bar"><div class="stat-bar-fill" id="monthlyBar" style="width:0%;background:var(--green)"></div></div></div>
  </div>
  <div class="section buy-only" id="loanSectionBuy"><div class="section-header"><div class="section-title">🏦 대출 한도 분석</div><div class="section-badge" id="loanBadge">실시간 계산</div></div>
    <div class="loan-grid">
      <div class="loan-card" id="ltvCard"><div class="loan-label">LTV 기준 최대 대출</div><div class="loan-big" id="ltvMax">—</div><div class="loan-detail" id="ltvDetail">—</div></div>
      <div class="loan-card" id="dsrCard"><div class="loan-label">DSR 기준 최대 대출</div><div class="loan-big" id="dsrMax">—</div><div class="loan-detail" id="dsrDetail">—</div></div>
      <div class="loan-card" id="monthlyCard"><div class="loan-label">월 상환 기준 최대 대출</div><div class="loan-big" id="monthlyMax">—</div><div class="loan-detail" id="monthlyDetail">—</div></div>
      <div class="loan-card" id="finalCard"><div class="loan-label">✅ 실제 가능 대출 (최솟값)</div><div class="loan-big" id="finalLoan" style="color:var(--mode-accent)">—</div><div class="loan-detail" id="finalDetail">—</div></div>
    </div>
  </div>
  <div class="section rent-only" id="loanSectionRent"><div class="section-header"><div class="section-title">🏦 전세 대출 분석</div><div class="section-badge" id="rentLoanBadge">실시간 계산</div></div>
    <div class="rent-loan-grid">
      <div class="loan-card ok" id="rentLimitCard"><div class="loan-label">전세대출 한도</div><div class="loan-big" id="rentLimitMax">—</div><div class="loan-detail" id="rentLimitDetail">—</div></div>
      <div class="loan-card" id="rentInterestCard"><div class="loan-label">월 이자 부담</div><div class="loan-big" id="rentInterest">—</div><div class="loan-detail" id="rentInterestDetail">—</div></div>
      <div class="loan-card ok" id="rentBudgetCard"><div class="loan-label">✅ 총 전세 예산</div><div class="loan-big" id="rentBudget" style="color:var(--mode-accent)">—</div><div class="loan-detail" id="rentBudgetDetail">—</div></div>
    </div>
  </div>
  <div class="section buy-only"><div class="section-header"><div class="section-title">🔍 매물 탐색 조건</div><div class="section-badge">현재 배치 설정 기준</div></div>
    <div class="condition-row"><div class="cond-chip">📐 59~84㎡ (20평대)</div><div class="cond-chip">🚇 역세권 도보 15분 이내</div><div class="cond-chip">🏢 200세대 이상</div><div class="cond-chip">💰 매매가 6억 이하</div><div class="cond-chip">🚋 신분당선 라인</div><div class="cond-chip">📍 서울 동남부 · 성남 · 용인 · 과천 · 안양 · 하남 · 광주 · 수원 · 군포 · 의왕 · 구리 · 광명</div></div>
  </div>
  <div class="section"><div class="section-header"><div class="section-title">🔗 부동산 사이트 바로가기</div></div>
    <div class="quick-links">
      <a href="https://new.land.naver.com/" target="_blank" class="quick-link"><span class="ql-icon">🟢</span><span class="ql-name">네이버 부동산</span><span class="ql-desc">매물 검색 · 시세</span></a>
      <a href="https://hogangnono.com/" target="_blank" class="quick-link"><span class="ql-icon">🟡</span><span class="ql-name">호갱노노</span><span class="ql-desc">실거래가 · 리뷰</span></a>
      <a href="https://asil.kr/" target="_blank" class="quick-link"><span class="ql-icon">🔵</span><span class="ql-name">아실</span><span class="ql-desc">실거래가 · 시세비교</span></a>
      <a href="https://kbland.kr/" target="_blank" class="quick-link"><span class="ql-icon">🟠</span><span class="ql-name">KB부동산</span><span class="ql-desc">KB시세 · 대출</span></a>
      <a href="https://rt.molit.go.kr/" target="_blank" class="quick-link"><span class="ql-icon">🏛️</span><span class="ql-name">국토부 실거래가</span><span class="ql-desc">공식 거래 데이터</span></a>
    </div>
  </div>
  <div class="tab-nav" id="tabNav">
    <button class="tab-btn active" onclick="switchTab('properties')" id="tabBtnProperties">📊 매물 시뮬레이션</button>
    <button class="tab-btn" onclick="switchTab('policy')" id="tabBtnPolicy">📜 정책 · 대출</button>
  </div>
  <div class="tab-content active" id="tab-properties">
    <div class="buy-only"><div class="section" style="margin-top:0;margin-bottom:0"><div class="section-header"><div class="section-title">🏘️ 관심 매물 시뮬레이션</div><div class="section-badge" id="propertyBadge">데이터 없음</div></div>
      <div class="filter-bar"><select class="filter-select" id="regionFilter" onchange="onBuyFilterChange()"><option value="">전체 지역</option></select><select class="filter-select" id="areaFilter" onchange="onBuyFilterChange()"><option value="">전체 면적</option><option value="small">소형 (~18평)</option><option value="mid">중형 (18~25평)</option><option value="large">대형 (25평+)</option></select><select class="filter-select" id="buyVerdictSelect" onchange="onBuyFilterChange()"><option value="">전체 판정</option><option value="매수가능">✅ 매수가능</option><option value="빠듯함">⚠️ 빠듯함</option><option value="상환초과">🔴 상환초과</option><option value="자금부족">🔴 자금부족</option></select><select class="filter-select" id="buyBuiltYearFilter" onchange="onBuyFilterChange()"><option value="">전체 연식</option><option value="5">🏗️ 5년 이내</option><option value="10">10년 이내</option><option value="15">15년 이내</option><option value="old">20년 이상 (구축)</option></select><select class="filter-select" id="buyCommuteFilter" onchange="onBuyFilterChange()"><option value="">전체 출퇴근</option><option value="transit60">🚌 1시간 이내</option><option value="subway60">🚇 1시간 이내</option><option value="transit45">🚌 45분 이내</option></select><div class="filter-bar-divider"></div><select class="filter-select" id="buySortSelect" onchange="onBuyFilterChange()"><option value="value">⭐ 가성비순</option><option value="price-asc">가격↑</option><option value="price-desc">가격↓</option><option value="area-desc">면적↓</option><option value="walk">역세권순</option><option value="commute">🚌 출퇴근순</option><option value="latest">최신거래순</option></select><input type="text" class="search-input" id="searchInput" placeholder="🔍 검색..." oninput="onBuyFilterChange()"><button class="filter-reset-btn" id="buyResetBtn" onclick="resetBuyFilters()" style="display:none">↺ 초기화</button><div class="filter-bar-divider"></div><div class="view-toggle"><button class="view-btn active" data-view="card" onclick="setView('card')" title="카드형">▦</button><button class="view-btn" data-view="table" onclick="setView('table')" title="테이블형">≡</button></div></div>
    </div></div>
    <div class="rent-only" id="rentPropertySection">
      <div id="rentTableWrap" style="display:none"><div class="section" style="margin-top:0;margin-bottom:0"><div class="section-header"><div class="section-title">🔑 전세 실거래 현황</div><div class="section-badge" id="rentPropertyBadge">데이터 없음</div></div>
        <div class="filter-bar"><select class="filter-select" id="rentRegionFilter" onchange="onRentFilterChange()"><option value="">전체 지역</option></select><select class="filter-select" id="rentAreaFilter" onchange="onRentFilterChange()"><option value="">전체 면적</option><option value="small">소형 (~18평)</option><option value="mid">중형 (18~25평)</option><option value="large">대형 (25평+)</option></select><select class="filter-select" id="rentVerdictSelect" onchange="onRentFilterChange()"><option value="">전체 판정</option><option value="가능">✅ 가능</option><option value="빠듯함">⚠️ 빠듯함</option><option value="예산초과">🔴 예산초과</option></select><select class="filter-select" id="rentTypeSelect" onchange="onRentFilterChange()"><option value="">전체 유형</option><option value="전세">🔑 전세</option><option value="월세">💳 월세</option></select><select class="filter-select" id="rentBuiltYearFilter" onchange="onRentFilterChange()"><option value="">전체 연식</option><option value="5">🏗️ 5년 이내</option><option value="10">10년 이내</option><option value="15">15년 이내</option><option value="old">20년 이상 (구축)</option></select><select class="filter-select" id="rentCommuteFilter" onchange="onRentFilterChange()"><option value="">전체 출퇴근</option><option value="transit60">🚌 1시간 이내</option><option value="subway60">🚇 1시간 이내</option><option value="transit45">🚌 45분 이내</option></select><div class="filter-bar-divider"></div><select class="filter-select" id="rentSortSelect" onchange="onRentFilterChange()"><option value="value">⭐ 가성비순</option><option value="price-asc">보증금↑</option><option value="price-desc">보증금↓</option><option value="area-desc">면적↓</option><option value="walk">역세권순</option><option value="commute">🚌 출퇴근순</option><option value="latest">최신거래순</option></select><input type="text" class="search-input" id="rentSearchInput" placeholder="🔍 검색..." oninput="onRentFilterChange()"><button class="filter-reset-btn" id="rentResetBtn" onclick="resetRentFilters()" style="display:none">↺ 초기화</button><div class="filter-bar-divider"></div><div class="view-toggle"><button class="view-btn active" data-view="card" onclick="setView('card')" title="카드형">▦</button><button class="view-btn" data-view="table" onclick="setView('table')" title="테이블형">≡</button></div></div>
      </div></div>
      <div class="rent-placeholder" id="rentPlaceholder"><div class="rent-placeholder-icon">🔑</div><div class="rent-placeholder-title">전세 매물 데이터 준비 중</div><div class="rent-placeholder-desc">전월세 실거래 데이터 파이프라인을 구축 중입니다.<br>현재는 위 시뮬레이터와 정책대출 탭으로 전세 예산을 분석할 수 있습니다.<br>아래 사이트에서 전세 매물을 직접 탐색해보세요.</div>
        <div class="rent-placeholder-links"><a href="https://new.land.naver.com/" target="_blank" class="quick-link" style="flex:none"><span class="ql-icon">🟢</span><span class="ql-name">네이버 전세</span></a><a href="https://kbland.kr/" target="_blank" class="quick-link" style="flex:none"><span class="ql-icon">🟠</span><span class="ql-name">KB부동산 전세</span></a><a href="https://asil.kr/" target="_blank" class="quick-link" style="flex:none"><span class="ql-icon">🔵</span><span class="ql-name">아실 전세</span></a></div>
      </div>
    </div>
    <div class="split-layout" id="splitLayout">
      <div class="mobile-split-tabs" id="mobileSplitTabs"><button class="mobile-split-tab" data-split="map" onclick="switchMobileSplit('map')">🗺 지도</button><button class="mobile-split-tab active" data-split="list" onclick="switchMobileSplit('list')">📋 리스트</button></div>
      <div class="split-map">
        <div id="mapContainer"></div>
        <div class="map-info-badge" id="mapBadge">로딩 중...</div>
        <button class="map-fullscreen-btn" id="mapFullscreenBtn" onclick="toggleMapFullscreen()">⛶ 전체</button>
        <label class="map-bounds-toggle" id="mapBoundsToggle"><input type="checkbox" id="mapBoundsCheck" checked onchange="toggleMapBounds(this.checked)"><span>지도 영역 내만 표시</span></label>
        <div class="map-legend"><span>🟢 매수/전세 가능</span><span>🟡 빠듯함</span><span>🔴 자금부족/예산초과</span><span>🔵 역 위치</span></div>
      </div>
      <div class="split-list" id="splitList">
        <div class="buy-only">
          <div class="card-grid" id="propertyCards"></div>
          <div class="table-wrap" id="buyTableWrap" style="display:none"><table><thead><tr><th class="col-verdict">판정</th><th class="col-name">단지명</th><th class="col-region">지역</th><th class="col-area"><span class="area-toggle" onclick="toggleAreaUnit()" title="클릭하여 전환">면적 <span id="areaUnitLabel">평</span></span></th><th class="col-price">매매가</th><th class="col-monthly">월상환</th><th style="min-width:70px">역세권</th><th style="min-width:50px">연식</th><th style="min-width:50px">세대</th><th class="col-link">링크</th></tr></thead><tbody id="propertyBody"></tbody></table></div>
          <div class="pagination-bar"><div style="display:flex;align-items:center;gap:8px;"><span>표시 건수</span><select class="page-size-select" id="pageSizeSelect" onchange="changePageSize(this.value)"><option value="20" selected>20개</option><option value="30">30개</option><option value="40">40개</option><option value="50">50개</option></select></div><div class="page-info" id="pageInfo"></div><div class="page-btns" id="pageBtns"></div></div>
        </div>
        <div class="rent-only">
          <div class="card-grid" id="rentPropertyCards"></div>
          <div class="table-wrap" id="rentTableWrapInner" style="display:none"><table><thead><tr><th class="col-verdict">판정</th><th class="col-name">단지명</th><th class="col-region">지역</th><th class="col-area">면적</th><th style="min-width:50px">유형</th><th class="col-price">보증금</th><th style="min-width:60px">월세</th><th style="min-width:70px">역세권</th><th style="min-width:50px">연식</th><th style="min-width:50px">세대</th><th class="col-link">링크</th></tr></thead><tbody id="rentPropertyBody"></tbody></table></div>
          <div class="pagination-bar"><div style="display:flex;align-items:center;gap:8px;"><span>표시 건수</span><select class="page-size-select" id="rentPageSizeSelect" onchange="changeRentPageSize(this.value)"><option value="20" selected>20개</option><option value="30">30개</option><option value="40">40개</option><option value="50">50개</option></select></div><div class="page-info" id="rentPageInfo"></div><div class="page-btns" id="rentPageBtns"></div></div>
        </div>
      </div>
    </div>
  </div>
  <div class="tab-content" id="tab-policy">
    <div class="section" style="margin-top:0"><div class="section-header"><div class="section-title">📜 최근 정책 변동</div><div class="section-badge">영향도 분석</div></div>
      <div class="timeline" id="policyTimeline"></div>
    </div>
    <div class="section"><div class="section-header"><div class="section-title">🎯 정책대출 자격 체크</div><div class="section-badge" id="policyBadge">소득 연동 자동 판정</div></div>
      <div style="font-size:11px;color:var(--text-dim);margin-bottom:10px" id="policyDateLabel">📅 기준: 2026년 2월 · 출처: 주택도시기금·한국주택금융공사 공시</div>
      <div class="policy-grid" id="policyGrid"></div>
    </div>
  </div>
  <div class="footer">설정(⚙️)에서 소득·자금·대출 조건을 변경하면 모든 숫자가 실시간으로 재계산됩니다</div>
</div>
<!-- Settings Overlay -->
<div class="settings-overlay" id="settingsOverlay" onclick="closeSettingsOutside(event)">
  <div class="settings-panel" onclick="event.stopPropagation()">
    <button class="settings-close" onclick="toggleSettings()">✕</button>
    <div class="settings-title">⚙️ 시뮬레이션 설정</div>
    <div class="section-label">👫 가구 소득</div>
    <div class="field"><label>본인 연소득</label><div class="field-row"><input type="range" id="income1" min="2000" max="10000" step="100" value="4740"><input type="number" class="field-value" id="income1Val" value="4740" min="0" max="99999"><span class="field-unit">만원</span></div></div>
    <div class="field"><label>배우자 연소득</label><div class="field-row"><input type="range" id="income2" min="2000" max="10000" step="100" value="4000"><input type="number" class="field-value" id="income2Val" value="4000" min="0" max="99999"><span class="field-unit">만원</span></div></div>
    <div class="section-label">💰 자금 현황</div>
    <div class="field"><label>총 가용 자금</label><div class="field-row"><input type="range" id="cash" min="3000" max="30000" step="500" value="15000"><input type="number" class="field-value" id="cashVal" value="15000" min="0" max="999999"><span class="field-unit">만원</span></div></div>
    <div class="field buy-only"><label>인테리어 예산</label><div class="field-row"><input type="range" id="interior" min="0" max="15000" step="500" value="5000"><input type="number" class="field-value" id="interiorVal" value="5000" min="0" max="999999"><span class="field-unit">만원</span></div></div>
    <div class="buy-only">
      <div class="section-label">🏦 매수 대출 조건</div>
      <div class="field"><label>예상 금리</label><div class="field-row"><input type="range" id="rate" min="2.0" max="6.0" step="0.1" value="4.0"><input type="number" class="field-value" id="rateVal" value="4.0" min="0" max="20" step="0.1"><span class="field-unit">%</span></div></div>
      <div class="field"><label>대출 만기</label><div class="field-row"><input type="range" id="term" min="10" max="40" step="5" value="30"><input type="number" class="field-value" id="termVal" value="30" min="1" max="50"><span class="field-unit">년</span></div></div>
      <div class="field"><label>월 상환 한도 (관리비 포함)</label><div class="field-row"><input type="range" id="monthlyLimit" min="100" max="400" step="10" value="200"><input type="number" class="field-value" id="monthlyLimitVal" value="200" min="0" max="9999"><span class="field-unit">만원</span></div></div>
      <div class="field"><label>관리비 예상</label><div class="field-row"><input type="range" id="mgmt" min="10" max="60" step="5" value="35"><input type="number" class="field-value" id="mgmtVal" value="35" min="0" max="999"><span class="field-unit">만원</span></div></div>
      <div class="section-label">📍 규제 설정 <span style="font-size:9px;color:var(--accent);letter-spacing:0">← 정부 정책</span></div>
      <div class="policy-ref"><div class="policy-ref-title">현행 LTV 기준</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--green)"></span> 비규제: 70%</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--yellow)"></span> 조정대상: 50%</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--red)"></span> 투기과열: 40%</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--blue)"></span> 생애최초: 80% (특례)</div></div>
      <div class="field"><label style="display:flex;align-items:center;gap:6px"><input type="checkbox" id="autoLtvCheckbox" checked style="accent-color:var(--accent);width:14px;height:14px"> 지역별 LTV 자동 적용 <span class="field-hint">(투기과열 40% / 비규제 70%)</span></label></div>
      <div class="field" id="ltvSliderField"><label>적용 LTV <span class="field-hint" id="ltvHint">지역별 자동 적용 중</span></label><div class="field-row"><input type="range" id="ltv" min="0" max="80" step="5" value="70" disabled><input type="number" class="field-value" id="ltvVal" value="70" min="0" max="100" disabled><span class="field-unit">%</span></div></div>
      <div class="policy-ref" style="margin-top:10px"><div class="policy-ref-title">현행 DSR 기준</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--text-mid)"></span> 전 금융권: 40%</div></div>
      <div class="field"><label>적용 DSR <span class="field-hint">시뮬레이션용</span></label><div class="field-row"><input type="range" id="dsr" min="20" max="60" step="5" value="40"><input type="number" class="field-value" id="dsrVal" value="40" min="0" max="100"><span class="field-unit">%</span></div></div>
    </div>
    <div class="rent-only">
      <div class="section-label">🏦 전세 대출 조건</div>
      <div class="field"><label>전세대출 유형</label><select id="rentLoanType" onchange="onRentTypeChange()"><option value="bank" selected>시중은행 전세대출</option><option value="policy">정책대출 (버팀목 등)</option></select></div>
      <div class="policy-ref" id="rentTypeRef"><div class="policy-ref-title">시중은행 전세대출 기준</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--yellow)"></span> 금리: 3.3~4.5%</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--blue)"></span> 한도: 보증한도 내 (HUG/HF/SGI)</div><div class="policy-ref-row"><span class="ref-dot" style="background:var(--text-mid)"></span> DSR 미적용, 소득 제한 없음</div></div>
      <div class="field"><label>전세대출 금리</label><div class="field-row"><input type="range" id="rentRate" min="1.0" max="6.0" step="0.1" value="3.8"><input type="number" class="field-value" id="rentRateVal" value="3.8" min="0" max="20" step="0.1"><span class="field-unit">%</span></div></div>
      <div class="field"><label>보증금 대비 대출비율</label><div class="field-row"><input type="range" id="rentLoanRatio" min="50" max="100" step="5" value="80"><input type="number" class="field-value" id="rentLoanRatioVal" value="80" min="0" max="100"><span class="field-unit">%</span></div></div>
      <div class="field"><label>전세대출 한도</label><div class="field-row"><input type="range" id="rentLoanLimit" min="5000" max="50000" step="1000" value="30000"><input type="number" class="field-value" id="rentLoanLimitVal" value="30000" min="0" max="999999"><span class="field-unit">만원</span></div></div>
    </div>
    <div class="section-label">🏘️ 주택 상태</div>
    <div class="field"><label>현재 주택 수</label><select id="houseCount"><option value="0">무주택</option><option value="1" selected>1주택 (대구)</option><option value="2">2주택 이상</option></select></div>
  </div>
</div>
<div class="mobile-map-popup" id="mobileMapPopup"><div id="mobileMapPopupContent"></div></div>
<div class="fs-map-popup" id="fsMapPopup"><button class="fs-map-popup-close" id="fsMapPopupClose">&times;</button><div id="fsMapPopupContent"></div></div>
<script src="app.js"></script>
</body>
</html>
