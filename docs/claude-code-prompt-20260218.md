# Claude Code 작업 프롬프트 — 2026.02.18

레포: HAAN6892/real-estate-monitor
배포: https://haan6892.github.io/real-estate-monitor/

---

## 작업 1: 지도 핀 누락 수정 (Critical)

### 문제
183개 매물 중 139개(76%)가 지도에 핀이 안 찍힘.
리스트에는 보이는데 지도에 안 보이는 상태.

### 원인 (분석 완료)
`loadData()` 함수에서 coord_cache.json과 data.json 매칭할 때 **지역명 형식 불일치**:

- coord_cache.json 키 형식: `"경기 수원시 장안구 보은맨션"` (정식 명칭)
- data.json의 region 형식: `"수원 장안구"` (축약형)

매칭 코드 1순위(`k.endsWith(p.name) && k.includes(p.region)`)에서:
- `"경기 수원시 장안구 보은맨션".includes("수원 장안구")` → **false** ("수원시"와 "수원" 불일치)
- `"경기 안양시 만안구 석수지웰아파트".includes("경기 안양 만안구")` → **false** ("안양시"와 "안양" 불일치)

**97건**: 캐시에 좌표 있는데 지역명 불일치로 매칭 실패
**42건**: 캐시에 좌표 자체가 없음

### 수정 방법

**1순위 매칭 로직 개선** — `loadData()` 함수의 coord_cache 매핑 부분:

기존: `k.includes(p.region)` 으로 단순 비교
변경: 지역명에서 "시" 제거하고 비교하거나, 더 유연한 매칭 로직 적용

```javascript
// 지역명 정규화 함수
function normalizeRegion(name) {
  // "경기 수원시 장안구" → "수원 장안구"
  // "경기 안양시 만안구" → "안양 만안구" (또는 "경기 안양 만안구")
  // "경기 용인시 기흥구" → "용인 기흥구"
  return name
    .replace(/^경기\s+/, '')  // 선두 "경기 " 제거
    .replace(/시\s+/g, ' ')   // "수원시 " → "수원 "
    .replace(/\s+/g, ' ')
    .trim();
}

// 매칭 시:
// 기존: k.includes(p.region)
// 변경: normalizeRegion(k).includes(normalizeRegion(p.region))
//       또는 normalizeRegion(k).includes(p.region)
```

핵심: coord_cache 키의 지역명을 정규화해서 data.json의 region과 비교.

**캐시에 없는 42건** — `geocodeUnmatchedProps()` 함수가 카카오 API로 자동 지오코딩하는 것 같은데, 이 함수가 제대로 동작하는지도 확인 필요. 안 되면 main.py(배치)에서 좌표를 미리 넣어주는 방식도 검토.

### 검증
수정 후 브라우저에서:
```javascript
// 콘솔에서 확인
fetch('data.json').then(r=>r.json()).then(d=>{
  const noCoord = d.properties.filter(p => !p.lat || !p.lon);
  console.log('좌표 없는 매물:', noCoord.length, '/', d.properties.length);
});
```
→ 좌표 없는 매물이 42건 이하(캐시에 없는 것만)면 성공.
→ 지도에서 핀이 100개+ 찍히면 성공.

### 커밋 메시지
"fix: coord_cache 지역명 매칭 로직 개선 (정규화 비교)"

---

## 작업 2: 호갱노노·아실 바로가기 링크 개선

### 문제
상단 "부동산 사이트 바로가기" 섹션의 링크들:
- 네이버 부동산: `https://new.land.naver.com/` → 홈페이지 (OK, 검색은 직접)
- 호갱노노: `https://hogangnono.com/` → 홈페이지만 뜸
- 아실: `https://asil.kr/` → 홈페이지만 뜸
- KB부동산: `https://kbland.kr/` → 홈페이지만 뜸

### 수정 방향
바로가기 섹션은 일반 사이트 링크이므로 홈페이지로 가는 게 맞음.
문제는 **각 매물 카드의 N, H 링크**가 해당 단지 검색으로 바로 연결되어야 하는데 제대로 안 되는 것.

현재 카드에 N(네이버), H(호갱노노) 링크가 있음:
- **N 링크**: `https://m.land.naver.com/search/result/{동+단지명}` → 대체로 작동
- **H 링크**: 호갱노노 검색 URL 확인 필요

### 수정 방법

1. **호갱노노 검색 URL 확인 후 적용**:
   - `https://hogangnono.com/apt/검색어` 또는 유사 패턴
   - 안 되면 H를 K(KB부동산)로 교체: `https://kbland.kr/map?search={단지명}`

2. **바로가기 섹션**:
   - 호갱노노: `https://hogangnono.com/region/` + 지역코드 형태가 가능한지 확인
   - 아실: `https://asil.kr/asil/index.jsp` (홈만 가능, 그대로 둠)
   - 각 링크에 설명 텍스트 약간 수정 (현재 "실거래가 · 리뷰" 등)

3. **카드 내 링크**:
   - N: 현행 유지 (네이버 검색 잘 됨)
   - H → 작동하는 검색 URL로 변경. 안 되면 K(KB)로 교체

### 커밋 메시지
"fix: 매물 카드 외부 링크 개선 (호갱노노/KB 검색 URL)"

---

## 작업 3: 모바일 UI/UX 개선

### 문제
1. **지도/리스트 토글 안 됨**: 모바일에서 "🗺 지도" / "📋 리스트" 서브탭 클릭해도 전환이 안 됨. 리스트가 계속 보이고 지도가 안 나타남.
2. **카드/테이블 뷰 토글(▦/≡) 동작 불안정**: 모바일에서 클릭 시 예상치 못한 필터 적용됨
3. **전반적인 모바일 사용성**: PC 대비 필터/정렬 조작이 불편

### 현재 모바일 레이아웃 (확인된 것)
- 상단: 매수/전세/설정 버튼 → OK
- 혼인신고 토글 → OK
- 요약 카드 → OK (세로 배치)
- 대출 한도 분석 → OK
- 매물 탐색 조건 → OK (가로 스크롤)
- 바로가기 → OK (2열 그리드)
- 탭 (매물 시뮬레이션/정책·대출) → OK
- 필터바 → 가로 스크롤, 좁음
- **지도/리스트 서브탭 → ❌ 전환 안 됨**
- 카드 리스트 → OK (1열, 보기 좋음)

### 수정 방법

**3-1. 지도/리스트 토글 수정**

모바일 전용 서브탭 (`mobileSubTab` 또는 유사 변수)이 클릭 이벤트에서 제대로 동작 안 하는 것 같음. 확인 포인트:

```javascript
// 모바일 서브탭 전환 함수 확인
// 지도 탭 클릭 시: 지도 컨테이너 display:block, 리스트 컨테이너 display:none
// 리스트 탭 클릭 시: 반대

// CSS @media (max-width: 768px) 에서
// .map-container, .list-container 의 display 제어 확인
```

가능한 원인:
- 이벤트 리스너가 안 걸려있거나 잘못된 셀렉터
- CSS에서 display가 제대로 토글 안 됨
- 지도 초기화가 모바일에서 안 됨 (카카오맵 크기 문제)

**3-2. PC-모바일 통일성 유지하면서 각 플랫폼에 맞게**

PC: 지도(58%) + 카드(42%) 좌우 분할 레이아웃
모바일: 지도/리스트 서브탭 전환 (동시에 보이지 않음)

이 구조는 맞는데, 전환 자체가 안 되는 게 문제.

**3-3. 필터바 모바일 개선**
- 현재: 5개 드롭다운이 가로로 나열 → 좁은 화면에서 텍스트 잘림
- 개선안: 필터 아이콘화 또는 2줄 배치
  - 1줄: [지역▼] [면적▼] [판정▼]
  - 2줄: [⭐정렬▼] [🔍검색]
  - 또는: 필터 버튼 하나 → 클릭 시 풀스크린 필터 패널

### 검증
1. 모바일 뷰포트(390x844)에서 지도/리스트 탭 전환 작동 확인
2. 지도 탭 클릭 시 지도가 보이고, 핀이 찍히는지
3. 리스트 탭 클릭 시 카드 리스트가 보이는지
4. 필터 조작이 자연스러운지

### 커밋 메시지
"fix: 모바일 지도/리스트 토글 수정 + 필터바 개선"

---

## 작업 순서

```
작업 1 (핀 누락) → 커밋/푸시 → 배포 확인
작업 2 (링크 개선) → 커밋/푸시 → 배포 확인
작업 3 (모바일 UI) → 커밋/푸시 → 배포 확인 (PC + 모바일)
```

작업 1이 가장 임팩트 크고 (76% 매물이 안 보이는 것), 작업 3이 가장 작업량 많음.
